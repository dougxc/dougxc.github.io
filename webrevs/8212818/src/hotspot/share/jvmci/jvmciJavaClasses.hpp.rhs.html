<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

    <script type="text/javascript" src="../../../../ancnav.js"></script>
    </head>
    <body id="SUNWwebrev" onkeypress="keypress(event);">
    <a name="0"></a>
    <pre></pre><hr></hr>
<pre>
   1 /*
   2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 #ifndef SHARE_VM_JVMCI_JVMCIJAVACLASSES_HPP
  25 #define SHARE_VM_JVMCI_JVMCIJAVACLASSES_HPP
  26 
  27 #include "classfile/systemDictionary.hpp"
  28 #include "oops/access.hpp"
  29 #include "oops/instanceMirrorKlass.hpp"
  30 #include "oops/oop.hpp"
  31 
  32 class JVMCIJavaClasses : AllStatic {
  33  public:
  34   static void compute_offsets(TRAPS);
  35 };
  36 
  37 /* This macro defines the structure of the JVMCI classes accessed from VM code.
  38  * It will generate classes with accessors similar to javaClasses.hpp, but with specializations for oops, Handles and jni handles.
  39  *
  40  * The public interface of these classes will look like this:
  41 
  42  * class StackSlot : AllStatic {
  43  * public:
  44  *   static Klass* klass();
  45  *   static jint  index(oop obj);
  46  *   static jint  index(Handle obj);
  47  *   static jint  index(jobject obj);
  48  *   static void set_index(oop obj, jint x);
  49  *   static void set_index(Handle obj, jint x);
  50  *   static void set_index(jobject obj, jint x);
  51  * };
  52  *
  53  */
  54 
  55 #define COMPILER_CLASSES_DO(start_class, end_class, char_field, int_field, boolean_field, long_field, float_field, oop_field, typeArrayOop_field, objArrayOop_field, static_oop_field, static_objArrayOop_field, static_int_field, static_boolean_field) \
  56   start_class(Architecture)                                                                                                                                    \
  57     oop_field(Architecture, wordKind, "Ljdk/vm/ci/meta/PlatformKind;")                                                                                         \
  58   end_class                                                                                                                                                    \
  59   start_class(TargetDescription)                                                                                                                               \
  60     oop_field(TargetDescription, arch, "Ljdk/vm/ci/code/Architecture;")                                                                                        \
  61   end_class                                                                                                                                                    \
  62   start_class(HotSpotResolvedObjectTypeImpl)                                                                                                                   \
  63     oop_field(HotSpotResolvedObjectTypeImpl, javaClass, "Ljava/lang/Class;")                                                                                   \
  64   end_class                                                                                                                                                    \
  65   start_class(HotSpotResolvedJavaMethodImpl)                                                                                                                   \
  66     long_field(HotSpotResolvedJavaMethodImpl, metaspaceMethod)                                                                                                 \
  67   end_class                                                                                                                                                    \
  68   start_class(InstalledCode)                                                                                                                                   \
  69     long_field(InstalledCode, address)                                                                                                                         \
  70     long_field(InstalledCode, entryPoint)                                                                                                                      \
  71     long_field(InstalledCode, version)                                                                                                                         \
  72     oop_field(InstalledCode, name, "Ljava/lang/String;")                                                                                                       \
  73   end_class                                                                                                                                                    \
  74   start_class(HotSpotInstalledCode)                                                                                                                            \
  75     int_field(HotSpotInstalledCode, size)                                                                                                                      \
  76     long_field(HotSpotInstalledCode, codeStart)                                                                                                                \
  77     int_field(HotSpotInstalledCode, codeSize)                                                                                                                  \
  78   end_class                                                                                                                                                    \
  79   start_class(HotSpotNmethod)                                                                                                                                  \
  80     boolean_field(HotSpotNmethod, isDefault)                                                                                                                   \
  81   end_class                                                                                                                                                    \
  82   start_class(HotSpotCompiledCode)                                                                                                                             \
  83     oop_field(HotSpotCompiledCode, name, "Ljava/lang/String;")                                                                                                 \
  84     typeArrayOop_field(HotSpotCompiledCode, targetCode, "[B")                                                                                                  \
  85     int_field(HotSpotCompiledCode, targetCodeSize)                                                                                                             \
  86     objArrayOop_field(HotSpotCompiledCode, sites, "[Ljdk/vm/ci/code/site/Site;")                                                                               \
  87     objArrayOop_field(HotSpotCompiledCode, assumptions, "[Ljdk/vm/ci/meta/Assumptions$Assumption;")                                                            \
  88     objArrayOop_field(HotSpotCompiledCode, methods, "[Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                    \
  89     objArrayOop_field(HotSpotCompiledCode, comments, "[Ljdk/vm/ci/hotspot/HotSpotCompiledCode$Comment;")                                                       \
  90     typeArrayOop_field(HotSpotCompiledCode, dataSection, "[B")                                                                                                 \
  91     int_field(HotSpotCompiledCode, dataSectionAlignment)                                                                                                       \
  92     objArrayOop_field(HotSpotCompiledCode, dataSectionPatches, "[Ljdk/vm/ci/code/site/DataPatch;")                                                             \
  93     boolean_field(HotSpotCompiledCode, isImmutablePIC)                                                                                                         \
  94     int_field(HotSpotCompiledCode, totalFrameSize)                                                                                                             \
  95     oop_field(HotSpotCompiledCode, deoptRescueSlot, "Ljdk/vm/ci/code/StackSlot;")                                                                              \
  96   end_class                                                                                                                                                    \
  97   start_class(HotSpotCompiledCode_Comment)                                                                                                                     \
  98     oop_field(HotSpotCompiledCode_Comment, text, "Ljava/lang/String;")                                                                                         \
  99     int_field(HotSpotCompiledCode_Comment, pcOffset)                                                                                                           \
 100   end_class                                                                                                                                                    \
 101   start_class(HotSpotCompiledNmethod)                                                                                                                          \
 102     oop_field(HotSpotCompiledNmethod, method, "Ljdk/vm/ci/hotspot/HotSpotResolvedJavaMethod;")                                                                 \
 103     oop_field(HotSpotCompiledNmethod, installationFailureMessage, "Ljava/lang/String;")                                                                        \
 104     int_field(HotSpotCompiledNmethod, entryBCI)                                                                                                                \
 105     int_field(HotSpotCompiledNmethod, id)                                                                                                                      \
 106     long_field(HotSpotCompiledNmethod, jvmciEnv)                                                                                                               \
 107     boolean_field(HotSpotCompiledNmethod, hasUnsafeAccess)                                                                                                     \
 108   end_class                                                                                                                                                    \
 109   start_class(HotSpotJVMCIMetaAccessContext)                                                                                                                   \
 110     static_objArrayOop_field(HotSpotJVMCIMetaAccessContext, allContexts, "[Ljava/lang/ref/WeakReference;")                                                     \
 111     objArrayOop_field(HotSpotJVMCIMetaAccessContext, metadataRoots, "[Ljava/lang/Object;")                                                                     \
 112   end_class                                                                                                                                                    \
 113   start_class(HotSpotForeignCallTarget)                                                                                                                        \
 114     long_field(HotSpotForeignCallTarget, address)                                                                                                              \
 115   end_class                                                                                                                                                    \
 116   start_class(VMField)                                                                                                                                         \
 117     oop_field(VMField, name, "Ljava/lang/String;")                                                                                                             \
 118     oop_field(VMField, type, "Ljava/lang/String;")                                                                                                             \
 119     long_field(VMField, offset)                                                                                                                                \
 120     long_field(VMField, address)                                                                                                                               \
 121     oop_field(VMField, value, "Ljava/lang/Object;")                                                                                                            \
 122   end_class                                                                                                                                                    \
 123   start_class(VMFlag)                                                                                                                                          \
 124     oop_field(VMFlag, name, "Ljava/lang/String;")                                                                                                              \
 125     oop_field(VMFlag, type, "Ljava/lang/String;")                                                                                                              \
 126     oop_field(VMFlag, value, "Ljava/lang/Object;")                                                                                                             \
 127   end_class                                                                                                                                                    \
 128   start_class(VMIntrinsicMethod)                                                                                                                               \
 129     oop_field(VMIntrinsicMethod, declaringClass, "Ljava/lang/String;")                                                                                         \
 130     oop_field(VMIntrinsicMethod, name, "Ljava/lang/String;")                                                                                                   \
 131     oop_field(VMIntrinsicMethod, descriptor, "Ljava/lang/String;")                                                                                             \
 132     int_field(VMIntrinsicMethod, id)                                                                                                                           \
 133   end_class                                                                                                                                                    \
 134   start_class(Assumptions_NoFinalizableSubclass)                                                                                                               \
 135     oop_field(Assumptions_NoFinalizableSubclass, receiverType, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                            \
 136   end_class                                                                                                                                                    \
 137   start_class(Assumptions_ConcreteSubtype)                                                                                                                     \
 138     oop_field(Assumptions_ConcreteSubtype, context, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                       \
 139     oop_field(Assumptions_ConcreteSubtype, subtype, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                       \
 140   end_class                                                                                                                                                    \
 141   start_class(Assumptions_LeafType)                                                                                                                            \
 142     oop_field(Assumptions_LeafType, context, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                              \
 143   end_class                                                                                                                                                    \
 144   start_class(Assumptions_ConcreteMethod)                                                                                                                      \
 145     oop_field(Assumptions_ConcreteMethod, method, "Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                       \
 146     oop_field(Assumptions_ConcreteMethod, context, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                        \
 147     oop_field(Assumptions_ConcreteMethod, impl, "Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                         \
 148   end_class                                                                                                                                                    \
 149   start_class(Assumptions_CallSiteTargetValue)                                                                                                                 \
 150     oop_field(Assumptions_CallSiteTargetValue, callSite, "Ljdk/vm/ci/meta/JavaConstant;")                                                                      \
 151     oop_field(Assumptions_CallSiteTargetValue, methodHandle, "Ljdk/vm/ci/meta/JavaConstant;")                                                                  \
 152   end_class                                                                                                                                                    \
 153   start_class(site_Site)                                                                                                                                       \
 154     int_field(site_Site, pcOffset)                                                                                                                             \
 155   end_class                                                                                                                                                    \
 156   start_class(site_Call)                                                                                                                                       \
 157     oop_field(site_Call, target, "Ljdk/vm/ci/meta/InvokeTarget;")                                                                                              \
 158     oop_field(site_Call, debugInfo, "Ljdk/vm/ci/code/DebugInfo;")                                                                                              \
 159   end_class                                                                                                                                                    \
 160   start_class(site_DataPatch)                                                                                                                                  \
 161     oop_field(site_DataPatch, reference, "Ljdk/vm/ci/code/site/Reference;")                                                                                    \
 162   end_class                                                                                                                                                    \
 163   start_class(site_ConstantReference)                                                                                                                          \
 164     oop_field(site_ConstantReference, constant, "Ljdk/vm/ci/meta/VMConstant;")                                                                                 \
 165   end_class                                                                                                                                                    \
 166   start_class(site_DataSectionReference)                                                                                                                       \
 167     int_field(site_DataSectionReference, offset)                                                                                                               \
 168   end_class                                                                                                                                                    \
 169   start_class(site_InfopointReason)                                                                                                                            \
 170     static_oop_field(site_InfopointReason, SAFEPOINT, "Ljdk/vm/ci/code/site/InfopointReason;")                                                                 \
 171     static_oop_field(site_InfopointReason, CALL, "Ljdk/vm/ci/code/site/InfopointReason;")                                                                      \
 172     static_oop_field(site_InfopointReason, IMPLICIT_EXCEPTION, "Ljdk/vm/ci/code/site/InfopointReason;")                                                        \
 173   end_class                                                                                                                                                    \
 174   start_class(site_Infopoint)                                                                                                                                  \
 175     oop_field(site_Infopoint, debugInfo, "Ljdk/vm/ci/code/DebugInfo;")                                                                                         \
 176     oop_field(site_Infopoint, reason, "Ljdk/vm/ci/code/site/InfopointReason;")                                                                                 \
 177   end_class                                                                                                                                                    \
 178   start_class(site_ExceptionHandler)                                                                                                                           \
 179     int_field(site_ExceptionHandler, handlerPos)                                                                                                               \
 180   end_class                                                                                                                                                    \
 181   start_class(site_Mark)                                                                                                                                       \
 182     oop_field(site_Mark, id, "Ljava/lang/Object;")                                                                                                             \
 183   end_class                                                                                                                                                    \
 184   start_class(HotSpotCompilationRequestResult)                                                                                                                 \
 185     oop_field(HotSpotCompilationRequestResult, failureMessage, "Ljava/lang/String;")                                                                           \
 186     boolean_field(HotSpotCompilationRequestResult, retry)                                                                                                      \
 187     int_field(HotSpotCompilationRequestResult, inlinedBytecodes)                                                                                               \
 188   end_class                                                                                                                                                    \
 189   start_class(DebugInfo)                                                                                                                                       \
 190     oop_field(DebugInfo, bytecodePosition, "Ljdk/vm/ci/code/BytecodePosition;")                                                                                \
 191     oop_field(DebugInfo, referenceMap, "Ljdk/vm/ci/code/ReferenceMap;")                                                                                        \
 192     oop_field(DebugInfo, calleeSaveInfo, "Ljdk/vm/ci/code/RegisterSaveLayout;")                                                                                \
 193     objArrayOop_field(DebugInfo, virtualObjectMapping, "[Ljdk/vm/ci/code/VirtualObject;")                                                                      \
 194   end_class                                                                                                                                                    \
 195   start_class(HotSpotReferenceMap)                                                                                                                             \
 196     objArrayOop_field(HotSpotReferenceMap, objects, "[Ljdk/vm/ci/code/Location;")                                                                              \
 197     objArrayOop_field(HotSpotReferenceMap, derivedBase, "[Ljdk/vm/ci/code/Location;")                                                                          \
 198     typeArrayOop_field(HotSpotReferenceMap, sizeInBytes, "[I")                                                                                                 \
 199     int_field(HotSpotReferenceMap, maxRegisterSize)                                                                                                            \
 200   end_class                                                                                                                                                    \
 201   start_class(RegisterSaveLayout)                                                                                                                              \
 202     objArrayOop_field(RegisterSaveLayout, registers, "[Ljdk/vm/ci/code/Register;")                                                                             \
 203     typeArrayOop_field(RegisterSaveLayout, slots, "[I")                                                                                                        \
 204   end_class                                                                                                                                                    \
 205   start_class(BytecodeFrame)                                                                                                                                   \
 206     objArrayOop_field(BytecodeFrame, values, "[Ljdk/vm/ci/meta/JavaValue;")                                                                                    \
 207     objArrayOop_field(BytecodeFrame, slotKinds, "[Ljdk/vm/ci/meta/JavaKind;")                                                                                  \
 208     int_field(BytecodeFrame, numLocals)                                                                                                                        \
 209     int_field(BytecodeFrame, numStack)                                                                                                                         \
 210     int_field(BytecodeFrame, numLocks)                                                                                                                         \
 211     boolean_field(BytecodeFrame, rethrowException)                                                                                                             \
 212     boolean_field(BytecodeFrame, duringCall)                                                                                                                   \
 213     static_int_field(BytecodeFrame, UNKNOWN_BCI)                                                                                                               \
 214     static_int_field(BytecodeFrame, UNWIND_BCI)                                                                                                                \
 215     static_int_field(BytecodeFrame, BEFORE_BCI)                                                                                                                \
 216     static_int_field(BytecodeFrame, AFTER_BCI)                                                                                                                 \
 217     static_int_field(BytecodeFrame, AFTER_EXCEPTION_BCI)                                                                                                       \
 218     static_int_field(BytecodeFrame, INVALID_FRAMESTATE_BCI)                                                                                                    \
 219   end_class                                                                                                                                                    \
 220   start_class(BytecodePosition)                                                                                                                                \
 221     oop_field(BytecodePosition, caller, "Ljdk/vm/ci/code/BytecodePosition;")                                                                                   \
 222     oop_field(BytecodePosition, method, "Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                                 \
 223     int_field(BytecodePosition, bci)                                                                                                                           \
 224   end_class                                                                                                                                                    \
 225   start_class(JavaConstant)                                                                                                                                    \
 226   end_class                                                                                                                                                    \
 227   start_class(PrimitiveConstant)                                                                                                                               \
 228     oop_field(PrimitiveConstant, kind, "Ljdk/vm/ci/meta/JavaKind;")                                                                                            \
 229     long_field(PrimitiveConstant, primitive)                                                                                                                   \
 230   end_class                                                                                                                                                    \
 231   start_class(RawConstant)                                                                                                                                     \
 232     long_field(RawConstant, primitive)                                                                                                                         \
 233   end_class                                                                                                                                                    \
 234   start_class(NullConstant)                                                                                                                                    \
 235   end_class                                                                                                                                                    \
 236   start_class(HotSpotCompressedNullConstant)                                                                                                                   \
 237   end_class                                                                                                                                                    \
 238   start_class(HotSpotObjectConstantImpl)                                                                                                                       \
 239     oop_field(HotSpotObjectConstantImpl, object, "Ljava/lang/Object;")                                                                                         \
 240     boolean_field(HotSpotObjectConstantImpl, compressed)                                                                                                       \
 241   end_class                                                                                                                                                    \
 242   start_class(HotSpotMetaspaceConstantImpl)                                                                                                                    \
 243     oop_field(HotSpotMetaspaceConstantImpl, metaspaceObject, "Ljdk/vm/ci/hotspot/MetaspaceWrapperObject;")                                                     \
 244     boolean_field(HotSpotMetaspaceConstantImpl, compressed)                                                                                                    \
 245   end_class                                                                                                                                                    \
 246   start_class(HotSpotSentinelConstant)                                                                                                                         \
 247   end_class                                                                                                                                                    \
 248   start_class(JavaKind)                                                                                                                                        \
 249     char_field(JavaKind, typeChar)                                                                                                                             \
 250     static_oop_field(JavaKind, Boolean, "Ljdk/vm/ci/meta/JavaKind;")                                                                                           \
 251     static_oop_field(JavaKind, Byte, "Ljdk/vm/ci/meta/JavaKind;")                                                                                              \
 252     static_oop_field(JavaKind, Char, "Ljdk/vm/ci/meta/JavaKind;")                                                                                              \
 253     static_oop_field(JavaKind, Short, "Ljdk/vm/ci/meta/JavaKind;")                                                                                             \
 254     static_oop_field(JavaKind, Int, "Ljdk/vm/ci/meta/JavaKind;")                                                                                               \
 255     static_oop_field(JavaKind, Long, "Ljdk/vm/ci/meta/JavaKind;")                                                                                              \
 256   end_class                                                                                                                                                    \
 257   start_class(ValueKind)                                                                                                                                       \
 258     oop_field(ValueKind, platformKind, "Ljdk/vm/ci/meta/PlatformKind;")                                                                                        \
 259   end_class                                                                                                                                                    \
 260   start_class(Value)                                                                                                                                           \
 261     oop_field(Value, valueKind, "Ljdk/vm/ci/meta/ValueKind;")                                                                                                  \
 262     static_oop_field(Value, ILLEGAL, "Ljdk/vm/ci/meta/AllocatableValue;")                                                                                      \
 263   end_class                                                                                                                                                    \
 264   start_class(RegisterValue)                                                                                                                                   \
 265     oop_field(RegisterValue, reg, "Ljdk/vm/ci/code/Register;")                                                                                                 \
 266   end_class                                                                                                                                                    \
 267   start_class(code_Location)                                                                                                                                   \
 268     oop_field(code_Location, reg, "Ljdk/vm/ci/code/Register;")                                                                                                 \
 269     int_field(code_Location, offset)                                                                                                                           \
 270   end_class                                                                                                                                                    \
 271   start_class(code_Register)                                                                                                                                   \
 272     int_field(code_Register, number)                                                                                                                           \
 273     int_field(code_Register, encoding)                                                                                                                         \
 274   end_class                                                                                                                                                    \
 275   start_class(StackSlot)                                                                                                                                       \
 276     int_field(StackSlot, offset)                                                                                                                               \
 277     boolean_field(StackSlot, addFrameSize)                                                                                                                     \
 278   end_class                                                                                                                                                    \
 279   start_class(VirtualObject)                                                                                                                                   \
 280     int_field(VirtualObject, id)                                                                                                                               \
<a name="1" id="anc1"></a><span class="new"> 281     oop_field(VirtualObject, baseObject, "Ljdk/vm/ci/meta/JavaValue;")                                                                                         \</span>
 282     oop_field(VirtualObject, type, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                                        \
 283     objArrayOop_field(VirtualObject, values, "[Ljdk/vm/ci/meta/JavaValue;")                                                                                    \
 284     objArrayOop_field(VirtualObject, slotKinds, "[Ljdk/vm/ci/meta/JavaKind;")                                                                                  \
 285   end_class                                                                                                                                                    \
 286   start_class(StackLockValue)                                                                                                                                  \
 287     oop_field(StackLockValue, owner, "Ljdk/vm/ci/meta/JavaValue;")                                                                                             \
 288     oop_field(StackLockValue, slot, "Ljdk/vm/ci/meta/AllocatableValue;")                                                                                       \
 289     boolean_field(StackLockValue, eliminated)                                                                                                                  \
 290   end_class                                                                                                                                                    \
 291   start_class(HotSpotSpeculationLog)                                                                                                                           \
 292     long_field(HotSpotSpeculationLog, lastFailed)                                                                                                              \
 293   end_class                                                                                                                                                    \
 294   start_class(HotSpotStackFrameReference)                                                                                                                      \
 295     oop_field(HotSpotStackFrameReference, compilerToVM, "Ljdk/vm/ci/hotspot/CompilerToVM;")                                                                    \
 296     boolean_field(HotSpotStackFrameReference, objectsMaterialized)                                                                                             \
 297     long_field(HotSpotStackFrameReference, stackPointer)                                                                                                       \
 298     int_field(HotSpotStackFrameReference, frameNumber)                                                                                                         \
 299     int_field(HotSpotStackFrameReference, bci)                                                                                                                 \
 300     oop_field(HotSpotStackFrameReference, method, "Ljdk/vm/ci/hotspot/HotSpotResolvedJavaMethod;")                                                             \
 301     objArrayOop_field(HotSpotStackFrameReference, locals, "[Ljava/lang/Object;")                                                                               \
 302     typeArrayOop_field(HotSpotStackFrameReference, localIsVirtual, "[Z")                                                                                       \
 303   end_class                                                                                                                                                    \
 304   start_class(HotSpotMetaData)                                                                                                                                 \
 305     typeArrayOop_field(HotSpotMetaData, pcDescBytes, "[B")                                                                                                     \
 306     typeArrayOop_field(HotSpotMetaData, scopesDescBytes, "[B")                                                                                                 \
 307     typeArrayOop_field(HotSpotMetaData, relocBytes, "[B")                                                                                                      \
 308     typeArrayOop_field(HotSpotMetaData, exceptionBytes, "[B")                                                                                                  \
 309     typeArrayOop_field(HotSpotMetaData, oopMaps, "[B")                                                                                                         \
 310     objArrayOop_field(HotSpotMetaData, metadata, "[Ljava/lang/Object;")                                                                                        \
 311   end_class                                                                                                                                                    \
 312   start_class(HotSpotConstantPool)                                                                                                                             \
 313     long_field(HotSpotConstantPool, metaspaceConstantPool)                                                                                                     \
 314   end_class                                                                                                                                                    \
 315   start_class(HotSpotJVMCIRuntime)                                                                                                                             \
 316     int_field(HotSpotJVMCIRuntime, compilationLevelAdjustment)                                                                                                 \
 317   end_class                                                                                                                                                    \
 318   /* end*/
 319 
 320 #define START_CLASS(name)                                                                                                                                      \
 321 class name : AllStatic {                                                                                                                                       \
 322   private:                                                                                                                                                     \
 323     friend class JVMCICompiler;                                                                                                                                \
 324     static void check(oop obj, const char* field_name, int offset);                                                                                            \
 325     static void compute_offsets(TRAPS);                                                                                                                        \
 326   public:                                                                                                                                                      \
 327   static InstanceKlass* klass() { return SystemDictionary::name##_klass_is_loaded() ? SystemDictionary::name##_klass() : NULL; }
 328 
 329 #define END_CLASS };
 330 
 331 #define FIELD(name, type, accessor, cast)                                                                                                                         \
 332     static int _##name##_offset;                                                                                                                                  \
 333     static type name(oop obj)                   { check(obj, #name, _##name##_offset); return cast obj-&gt;accessor(_##name##_offset); }                             \
 334     static type name(Handle obj)                { check(obj(), #name, _##name##_offset); return cast obj-&gt;accessor(_##name##_offset); }                           \
 335     static type name(jobject obj);                                                                                                                                \
 336     static void set_##name(oop obj, type x)     { check(obj, #name, _##name##_offset); obj-&gt;accessor##_put(_##name##_offset, x); }                                \
 337     static void set_##name(Handle obj, type x)  { check(obj(), #name, _##name##_offset); obj-&gt;accessor##_put(_##name##_offset, x); }                              \
 338     static void set_##name(jobject obj, type x);                                                                                                                  \
 339 
 340 #define EMPTY_CAST
 341 #define CHAR_FIELD(klass, name) FIELD(name, jchar, char_field, EMPTY_CAST)
 342 #define INT_FIELD(klass, name) FIELD(name, jint, int_field, EMPTY_CAST)
 343 #define BOOLEAN_FIELD(klass, name) FIELD(name, jboolean, bool_field, EMPTY_CAST)
 344 #define LONG_FIELD(klass, name) FIELD(name, jlong, long_field, EMPTY_CAST)
 345 #define FLOAT_FIELD(klass, name) FIELD(name, jfloat, float_field, EMPTY_CAST)
 346 #define OOP_FIELD(klass, name, signature) FIELD(name, oop, obj_field, EMPTY_CAST)
 347 #define OBJARRAYOOP_FIELD(klass, name, signature) FIELD(name, objArrayOop, obj_field, (objArrayOop))
 348 #define TYPEARRAYOOP_FIELD(klass, name, signature) FIELD(name, typeArrayOop, obj_field, (typeArrayOop))
 349 #define STATIC_OOP_FIELD(klassName, name, signature) STATIC_OOPISH_FIELD(klassName, name, oop, signature)
 350 #define STATIC_OBJARRAYOOP_FIELD(klassName, name, signature) STATIC_OOPISH_FIELD(klassName, name, objArrayOop, signature)
 351 #define STATIC_OOPISH_FIELD(klassName, name, type, signature)                                                  \
 352     static int _##name##_offset;                                                                               \
 353     static type name();                                                                                        \
 354     static void set_##name(type x);
 355 #define STATIC_PRIMITIVE_FIELD(klassName, name, jtypename)                                                     \
 356     static int _##name##_offset;                                                                               \
 357     static jtypename name();                                                                                   \
 358     static void set_##name(jtypename x);
 359 
 360 #define STATIC_INT_FIELD(klassName, name) STATIC_PRIMITIVE_FIELD(klassName, name, jint)
 361 #define STATIC_BOOLEAN_FIELD(klassName, name) STATIC_PRIMITIVE_FIELD(klassName, name, jboolean)
 362 
 363 COMPILER_CLASSES_DO(START_CLASS, END_CLASS, CHAR_FIELD, INT_FIELD, BOOLEAN_FIELD, LONG_FIELD, FLOAT_FIELD, OOP_FIELD, TYPEARRAYOOP_FIELD, OBJARRAYOOP_FIELD, STATIC_OOP_FIELD, STATIC_OBJARRAYOOP_FIELD, STATIC_INT_FIELD, STATIC_BOOLEAN_FIELD)
 364 #undef START_CLASS
 365 #undef END_CLASS
 366 #undef FIELD
 367 #undef CHAR_FIELD
 368 #undef INT_FIELD
 369 #undef BOOLEAN_FIELD
 370 #undef LONG_FIELD
 371 #undef FLOAT_FIELD
 372 #undef OOP_FIELD
 373 #undef TYPEARRAYOOP_FIELD
 374 #undef OBJARRAYOOP_FIELD
 375 #undef STATIC_OOPISH_FIELD
 376 #undef STATIC_OOP_FIELD
 377 #undef STATIC_OBJARRAYOOP_FIELD
 378 #undef STATIC_INT_FIELD
 379 #undef STATIC_BOOLEAN_FIELD
 380 #undef STATIC_PRIMITIVE_FIELD
 381 #undef EMPTY_CAST
 382 
 383 void compute_offset(int &amp;dest_offset, Klass* klass, const char* name, const char* signature, bool static_field, TRAPS);
 384 
 385 #endif // SHARE_VM_JVMCI_JVMCIJAVACLASSES_HPP
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>















































































</pre><form name="eof"><input name="value" value="2" type="hidden" /></form></body></html>
