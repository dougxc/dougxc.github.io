<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>Old src/share/vm/jvmci/jvmciJavaClasses.hpp</title>
<body id="SUNWwebrev">
<pre>
   1 /*
   2  * Copyright (c) 2011, 2016, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 #ifndef SHARE_VM_JVMCI_JVMCIJAVACLASSES_HPP
  25 #define SHARE_VM_JVMCI_JVMCIJAVACLASSES_HPP
  26 
  27 #include "classfile/systemDictionary.hpp"
  28 #include "oops/instanceMirrorKlass.hpp"
  29 #include "oops/oop.inline.hpp"
  30 
  31 class JVMCIJavaClasses : AllStatic {
  32  public:
  33   static void compute_offsets(TRAPS);
  34 };
  35 
  36 /* This macro defines the structure of the JVMCI classes accessed from VM code.
  37  * It will generate classes with accessors similar to javaClasses.hpp, but with specializations for oops, Handles and jni handles.
  38  *
  39  * The public interface of these classes will look like this:
  40 
  41  * class StackSlot : AllStatic {
  42  * public:
  43  *   static Klass* klass();
  44  *   static jint  index(oop obj);
  45  *   static jint  index(Handle obj);
  46  *   static jint  index(jobject obj);
  47  *   static void set_index(oop obj, jint x);
  48  *   static void set_index(Handle obj, jint x);
  49  *   static void set_index(jobject obj, jint x);
  50  * };
  51  *
  52  */
  53 
  54 #define COMPILER_CLASSES_DO(start_class, end_class, char_field, int_field, boolean_field, long_field, float_field, oop_field, typeArrayOop_field, objArrayOop_field, static_oop_field, static_objArrayOop_field, static_int_field, static_boolean_field) \
  55   start_class(Architecture)                                                                                                                                    \
  56     oop_field(Architecture, wordKind, "Ljdk/vm/ci/meta/PlatformKind;")                                                                                         \
  57   end_class                                                                                                                                                    \
  58   start_class(TargetDescription)                                                                                                                               \
  59     oop_field(TargetDescription, arch, "Ljdk/vm/ci/code/Architecture;")                                                                                        \
  60   end_class                                                                                                                                                    \
  61   start_class(HotSpotResolvedObjectTypeImpl)                                                                                                                   \
  62     oop_field(HotSpotResolvedObjectTypeImpl, javaClass, "Ljava/lang/Class;")                                                                                   \
  63   end_class                                                                                                                                                    \
  64   start_class(HotSpotResolvedJavaMethodImpl)                                                                                                                   \
  65     long_field(HotSpotResolvedJavaMethodImpl, metaspaceMethod)                                                                                                 \
  66   end_class                                                                                                                                                    \
  67   start_class(InstalledCode)                                                                                                                                   \
  68     long_field(InstalledCode, address)                                                                                                                         \
  69     long_field(InstalledCode, entryPoint)                                                                                                                      \
  70     long_field(InstalledCode, version)                                                                                                                         \
  71     oop_field(InstalledCode, name, "Ljava/lang/String;")                                                                                                       \
  72   end_class                                                                                                                                                    \
  73   start_class(HotSpotInstalledCode)                                                                                                                            \
  74     int_field(HotSpotInstalledCode, size)                                                                                                                      \
  75     long_field(HotSpotInstalledCode, codeStart)                                                                                                                \
  76     int_field(HotSpotInstalledCode, codeSize)                                                                                                                  \
  77   end_class                                                                                                                                                    \
  78   start_class(HotSpotNmethod)                                                                                                                                  \
  79     boolean_field(HotSpotNmethod, isDefault)                                                                                                                   \
  80   end_class                                                                                                                                                    \
  81   start_class(HotSpotCompiledCode)                                                                                                                             \
  82     oop_field(HotSpotCompiledCode, name, "Ljava/lang/String;")                                                                                                 \
  83     typeArrayOop_field(HotSpotCompiledCode, targetCode, "[B")                                                                                                  \
  84     int_field(HotSpotCompiledCode, targetCodeSize)                                                                                                             \
  85     objArrayOop_field(HotSpotCompiledCode, sites, "[Ljdk/vm/ci/code/site/Site;")                                                                               \
  86     objArrayOop_field(HotSpotCompiledCode, assumptions, "[Ljdk/vm/ci/meta/Assumptions$Assumption;")                                                            \
  87     objArrayOop_field(HotSpotCompiledCode, methods, "[Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                    \
  88     objArrayOop_field(HotSpotCompiledCode, comments, "[Ljdk/vm/ci/hotspot/HotSpotCompiledCode$Comment;")                                                       \
  89     typeArrayOop_field(HotSpotCompiledCode, dataSection, "[B")                                                                                                 \
  90     int_field(HotSpotCompiledCode, dataSectionAlignment)                                                                                                       \
  91     objArrayOop_field(HotSpotCompiledCode, dataSectionPatches, "[Ljdk/vm/ci/code/site/DataPatch;")                                                             \
  92     boolean_field(HotSpotCompiledCode, isImmutablePIC)                                                                                                         \
  93     int_field(HotSpotCompiledCode, totalFrameSize)                                                                                                             \
  94     oop_field(HotSpotCompiledCode, deoptRescueSlot, "Ljdk/vm/ci/code/StackSlot;")                                                                              \
  95   end_class                                                                                                                                                    \
  96   start_class(HotSpotCompiledCode_Comment)                                                                                                                     \
  97     oop_field(HotSpotCompiledCode_Comment, text, "Ljava/lang/String;")                                                                                         \
  98     int_field(HotSpotCompiledCode_Comment, pcOffset)                                                                                                           \
  99   end_class                                                                                                                                                    \
 100   start_class(HotSpotCompiledNmethod)                                                                                                                          \
 101     oop_field(HotSpotCompiledNmethod, method, "Ljdk/vm/ci/hotspot/HotSpotResolvedJavaMethod;")                                                                 \
 102     oop_field(HotSpotCompiledNmethod, installationFailureMessage, "Ljava/lang/String;")                                                                        \
 103     int_field(HotSpotCompiledNmethod, entryBCI)                                                                                                                \
 104     int_field(HotSpotCompiledNmethod, id)                                                                                                                      \
 105     long_field(HotSpotCompiledNmethod, jvmciEnv)                                                                                                               \
 106     boolean_field(HotSpotCompiledNmethod, hasUnsafeAccess)                                                                                                     \
 107   end_class                                                                                                                                                    \
 108   start_class(HotSpotJVMCIMetaAccessContext)                                                                                                                   \
 109     static_objArrayOop_field(HotSpotJVMCIMetaAccessContext, allContexts, "[Ljava/lang/ref/WeakReference;")                                                     \
 110     objArrayOop_field(HotSpotJVMCIMetaAccessContext, metadataRoots, "[Ljava/lang/Object;")                                                                     \
 111   end_class                                                                                                                                                    \
 112   start_class(HotSpotForeignCallTarget)                                                                                                                        \
 113     long_field(HotSpotForeignCallTarget, address)                                                                                                              \
 114   end_class                                                                                                                                                    \
 115   start_class(Assumptions_NoFinalizableSubclass)                                                                                                               \
 116     oop_field(Assumptions_NoFinalizableSubclass, receiverType, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                            \
 117   end_class                                                                                                                                                    \
 118   start_class(Assumptions_ConcreteSubtype)                                                                                                                     \
 119     oop_field(Assumptions_ConcreteSubtype, context, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                       \
 120     oop_field(Assumptions_ConcreteSubtype, subtype, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                       \
 121   end_class                                                                                                                                                    \
 122   start_class(Assumptions_LeafType)                                                                                                                            \
 123     oop_field(Assumptions_LeafType, context, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                              \
 124   end_class                                                                                                                                                    \
 125   start_class(Assumptions_ConcreteMethod)                                                                                                                      \
 126     oop_field(Assumptions_ConcreteMethod, method, "Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                       \
 127     oop_field(Assumptions_ConcreteMethod, context, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                        \
 128     oop_field(Assumptions_ConcreteMethod, impl, "Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                         \
 129   end_class                                                                                                                                                    \
 130   start_class(Assumptions_CallSiteTargetValue)                                                                                                                 \
 131     oop_field(Assumptions_CallSiteTargetValue, callSite, "Ljava/lang/invoke/CallSite;")                                                                        \
 132     oop_field(Assumptions_CallSiteTargetValue, methodHandle, "Ljava/lang/invoke/MethodHandle;")                                                                \
 133   end_class                                                                                                                                                    \
 134   start_class(site_Site)                                                                                                                                       \
 135     int_field(site_Site, pcOffset)                                                                                                                             \
 136   end_class                                                                                                                                                    \
 137   start_class(site_Call)                                                                                                                                       \
 138     oop_field(site_Call, target, "Ljdk/vm/ci/meta/InvokeTarget;")                                                                                              \
 139     oop_field(site_Call, debugInfo, "Ljdk/vm/ci/code/DebugInfo;")                                                                                              \
 140   end_class                                                                                                                                                    \
 141   start_class(site_DataPatch)                                                                                                                                  \
 142     oop_field(site_DataPatch, reference, "Ljdk/vm/ci/code/site/Reference;")                                                                                    \
 143   end_class                                                                                                                                                    \
 144   start_class(site_ConstantReference)                                                                                                                          \
 145     oop_field(site_ConstantReference, constant, "Ljdk/vm/ci/meta/VMConstant;")                                                                                 \
 146   end_class                                                                                                                                                    \
 147   start_class(site_DataSectionReference)                                                                                                                       \
 148     int_field(site_DataSectionReference, offset)                                                                                                               \
 149   end_class                                                                                                                                                    \
 150   start_class(site_InfopointReason)                                                                                                                            \
 151     static_oop_field(site_InfopointReason, SAFEPOINT, "Ljdk/vm/ci/code/site/InfopointReason;")                                                                 \
 152     static_oop_field(site_InfopointReason, CALL, "Ljdk/vm/ci/code/site/InfopointReason;")                                                                      \
 153     static_oop_field(site_InfopointReason, IMPLICIT_EXCEPTION, "Ljdk/vm/ci/code/site/InfopointReason;")                                                        \
 154   end_class                                                                                                                                                    \
 155   start_class(site_Infopoint)                                                                                                                                  \
 156     oop_field(site_Infopoint, debugInfo, "Ljdk/vm/ci/code/DebugInfo;")                                                                                         \
 157     oop_field(site_Infopoint, reason, "Ljdk/vm/ci/code/site/InfopointReason;")                                                                                 \
 158   end_class                                                                                                                                                    \
 159   start_class(site_ExceptionHandler)                                                                                                                           \
 160     int_field(site_ExceptionHandler, handlerPos)                                                                                                               \
 161   end_class                                                                                                                                                    \
 162   start_class(site_Mark)                                                                                                                                       \
 163     oop_field(site_Mark, id, "Ljava/lang/Object;")                                                                                                             \
 164   end_class                                                                                                                                                    \
 165   start_class(CompilationRequestResult)                                                                                                                        \
 166     oop_field(CompilationRequestResult, failureMessage, "Ljava/lang/String;")                                                                                  \
 167     boolean_field(CompilationRequestResult, retry)                                                                                                             \
 168     int_field(CompilationRequestResult, inlinedBytecodes)                                                                                                      \
 169   end_class                                                                                                                                                    \
 170   start_class(DebugInfo)                                                                                                                                       \
 171     oop_field(DebugInfo, bytecodePosition, "Ljdk/vm/ci/code/BytecodePosition;")                                                                                \
 172     oop_field(DebugInfo, referenceMap, "Ljdk/vm/ci/code/ReferenceMap;")                                                                                        \
 173     oop_field(DebugInfo, calleeSaveInfo, "Ljdk/vm/ci/code/RegisterSaveLayout;")                                                                                \
 174     objArrayOop_field(DebugInfo, virtualObjectMapping, "[Ljdk/vm/ci/code/VirtualObject;")                                                                      \
 175   end_class                                                                                                                                                    \
 176   start_class(HotSpotReferenceMap)                                                                                                                             \
 177     objArrayOop_field(HotSpotReferenceMap, objects, "[Ljdk/vm/ci/code/Location;")                                                                              \
 178     objArrayOop_field(HotSpotReferenceMap, derivedBase, "[Ljdk/vm/ci/code/Location;")                                                                          \
 179     typeArrayOop_field(HotSpotReferenceMap, sizeInBytes, "[I")                                                                                                 \
 180     int_field(HotSpotReferenceMap, maxRegisterSize)                                                                                                            \
 181   end_class                                                                                                                                                    \
 182   start_class(RegisterSaveLayout)                                                                                                                              \
 183     objArrayOop_field(RegisterSaveLayout, registers, "[Ljdk/vm/ci/code/Register;")                                                                             \
 184     typeArrayOop_field(RegisterSaveLayout, slots, "[I")                                                                                                        \
 185   end_class                                                                                                                                                    \
 186   start_class(BytecodeFrame)                                                                                                                                   \
 187     objArrayOop_field(BytecodeFrame, values, "[Ljdk/vm/ci/meta/JavaValue;")                                                                                    \
 188     objArrayOop_field(BytecodeFrame, slotKinds, "[Ljdk/vm/ci/meta/JavaKind;")                                                                                  \
 189     int_field(BytecodeFrame, numLocals)                                                                                                                        \
 190     int_field(BytecodeFrame, numStack)                                                                                                                         \
 191     int_field(BytecodeFrame, numLocks)                                                                                                                         \
 192     boolean_field(BytecodeFrame, rethrowException)                                                                                                             \
 193     boolean_field(BytecodeFrame, duringCall)                                                                                                                   \
 194     static_int_field(BytecodeFrame, BEFORE_BCI)                                                                                                                \
 195   end_class                                                                                                                                                    \
 196   start_class(BytecodePosition)                                                                                                                                \
 197     oop_field(BytecodePosition, caller, "Ljdk/vm/ci/code/BytecodePosition;")                                                                                   \
 198     oop_field(BytecodePosition, method, "Ljdk/vm/ci/meta/ResolvedJavaMethod;")                                                                                 \
 199     int_field(BytecodePosition, bci)                                                                                                                           \
 200   end_class                                                                                                                                                    \
 201   start_class(JavaConstant)                                                                                                                                    \
 202   end_class                                                                                                                                                    \
 203   start_class(PrimitiveConstant)                                                                                                                               \
 204     oop_field(PrimitiveConstant, kind, "Ljdk/vm/ci/meta/JavaKind;")                                                                                            \
 205     long_field(PrimitiveConstant, primitive)                                                                                                                   \
 206   end_class                                                                                                                                                    \
 207   start_class(RawConstant)                                                                                                                                     \
 208     long_field(RawConstant, primitive)                                                                                                                         \
 209   end_class                                                                                                                                                    \
 210   start_class(NullConstant)                                                                                                                                    \
 211   end_class                                                                                                                                                    \
 212   start_class(HotSpotCompressedNullConstant)                                                                                                                   \
 213   end_class                                                                                                                                                    \
 214   start_class(HotSpotObjectConstantImpl)                                                                                                                       \
 215     oop_field(HotSpotObjectConstantImpl, object, "Ljava/lang/Object;")                                                                                         \
 216     boolean_field(HotSpotObjectConstantImpl, compressed)                                                                                                       \
 217   end_class                                                                                                                                                    \
 218   start_class(HotSpotMetaspaceConstantImpl)                                                                                                                    \
 219     oop_field(HotSpotMetaspaceConstantImpl, metaspaceObject, "Ljdk/vm/ci/hotspot/MetaspaceWrapperObject;")                                                     \
 220     boolean_field(HotSpotMetaspaceConstantImpl, compressed)                                                                                                    \
 221   end_class                                                                                                                                                    \
 222   start_class(HotSpotSentinelConstant)                                                                                                                         \
 223   end_class                                                                                                                                                    \
 224   start_class(JavaKind)                                                                                                                                        \
 225     char_field(JavaKind, typeChar)                                                                                                                             \
 226     static_oop_field(JavaKind, Boolean, "Ljdk/vm/ci/meta/JavaKind;");                                                                                          \
 227     static_oop_field(JavaKind, Byte, "Ljdk/vm/ci/meta/JavaKind;");                                                                                             \
 228     static_oop_field(JavaKind, Char, "Ljdk/vm/ci/meta/JavaKind;");                                                                                             \
 229     static_oop_field(JavaKind, Short, "Ljdk/vm/ci/meta/JavaKind;");                                                                                            \
 230     static_oop_field(JavaKind, Int, "Ljdk/vm/ci/meta/JavaKind;");                                                                                              \
 231     static_oop_field(JavaKind, Long, "Ljdk/vm/ci/meta/JavaKind;");                                                                                             \
 232   end_class                                                                                                                                                    \
 233   start_class(ValueKind)                                                                                                                                       \
 234     oop_field(ValueKind, platformKind, "Ljdk/vm/ci/meta/PlatformKind;")                                                                                        \
 235   end_class                                                                                                                                                    \
 236   start_class(Value)                                                                                                                                           \
 237     oop_field(Value, valueKind, "Ljdk/vm/ci/meta/ValueKind;")                                                                                                  \
 238     static_oop_field(Value, ILLEGAL, "Ljdk/vm/ci/meta/AllocatableValue;");                                                                                     \
 239   end_class                                                                                                                                                    \
 240   start_class(RegisterValue)                                                                                                                                   \
 241     oop_field(RegisterValue, reg, "Ljdk/vm/ci/code/Register;")                                                                                                 \
 242   end_class                                                                                                                                                    \
 243   start_class(code_Location)                                                                                                                                   \
 244     oop_field(code_Location, reg, "Ljdk/vm/ci/code/Register;")                                                                                                 \
 245     int_field(code_Location, offset)                                                                                                                           \
 246   end_class                                                                                                                                                    \
 247   start_class(code_Register)                                                                                                                                   \
 248     int_field(code_Register, number)                                                                                                                           \
 249     int_field(code_Register, encoding)                                                                                                                         \
 250   end_class                                                                                                                                                    \
 251   start_class(StackSlot)                                                                                                                                       \
 252     int_field(StackSlot, offset)                                                                                                                               \
 253     boolean_field(StackSlot, addFrameSize)                                                                                                                     \
 254   end_class                                                                                                                                                    \
 255   start_class(VirtualObject)                                                                                                                                   \
 256     int_field(VirtualObject, id)                                                                                                                               \
 257     oop_field(VirtualObject, type, "Ljdk/vm/ci/meta/ResolvedJavaType;")                                                                                        \
 258     objArrayOop_field(VirtualObject, values, "[Ljdk/vm/ci/meta/JavaValue;")                                                                                    \
 259     objArrayOop_field(VirtualObject, slotKinds, "[Ljdk/vm/ci/meta/JavaKind;")                                                                                  \
 260   end_class                                                                                                                                                    \
 261   start_class(StackLockValue)                                                                                                                                  \
 262     oop_field(StackLockValue, owner, "Ljdk/vm/ci/meta/JavaValue;")                                                                                             \
 263     oop_field(StackLockValue, slot, "Ljdk/vm/ci/meta/AllocatableValue;")                                                                                       \
 264     boolean_field(StackLockValue, eliminated)                                                                                                                  \
 265   end_class                                                                                                                                                    \
 266   start_class(HotSpotSpeculationLog)                                                                                                                           \
 267     oop_field(HotSpotSpeculationLog, lastFailed, "Ljava/lang/Object;")                                                                                         \
 268   end_class                                                                                                                                                    \
 269   start_class(HotSpotStackFrameReference)                                                                                                                      \
 270     oop_field(HotSpotStackFrameReference, compilerToVM, "Ljdk/vm/ci/hotspot/CompilerToVM;")                                                                    \
 271     long_field(HotSpotStackFrameReference, stackPointer)                                                                                                       \
 272     int_field(HotSpotStackFrameReference, frameNumber)                                                                                                         \
 273     int_field(HotSpotStackFrameReference, bci)                                                                                                                 \
 274     oop_field(HotSpotStackFrameReference, method, "Ljdk/vm/ci/hotspot/HotSpotResolvedJavaMethod;")                                                             \
 275     objArrayOop_field(HotSpotStackFrameReference, locals, "[Ljava/lang/Object;")                                                                               \
 276     typeArrayOop_field(HotSpotStackFrameReference, localIsVirtual, "[Z")                                                                                       \
 277   end_class                                                                                                                                                    \
 278   start_class(HotSpotMetaData)                                                                                                                                 \
 279     typeArrayOop_field(HotSpotMetaData, pcDescBytes, "[B")                                                                                                     \
 280     typeArrayOop_field(HotSpotMetaData, scopesDescBytes, "[B")                                                                                                 \
 281     typeArrayOop_field(HotSpotMetaData, relocBytes, "[B")                                                                                                      \
 282     typeArrayOop_field(HotSpotMetaData, exceptionBytes, "[B")                                                                                                  \
 283     typeArrayOop_field(HotSpotMetaData, oopMaps, "[B")                                                                                                         \
 284     objArrayOop_field(HotSpotMetaData, metadata, "[Ljava/lang/String;")                                                                                        \
 285   end_class                                                                                                                                                    \
 286   start_class(HotSpotOopMap)                                                                                                                                   \
 287     int_field(HotSpotOopMap, offset)                                                                                                                           \
 288     int_field(HotSpotOopMap, count)                                                                                                                            \
 289     typeArrayOop_field(HotSpotOopMap, data, "[B")                                                                                                              \
 290   end_class                                                                                                                                                    \
 291   start_class(HotSpotConstantPool)                                                                                                                             \
 292     long_field(HotSpotConstantPool, metaspaceConstantPool)                                                                                                     \
 293   end_class                                                                                                                                                    \
 294   start_class(HotSpotJVMCIRuntime)                                                                                                                             \
 295     objArrayOop_field(HotSpotJVMCIRuntime, trivialPrefixes, "[Ljava/lang/String;")                                                                             \
 296     int_field(HotSpotJVMCIRuntime, compilationLevelAdjustment)                                                                                                 \
 297   end_class                                                                                                                                                    \
 298   /* end*/
 299 
 300 #define START_CLASS(name)                                                                                                                                      \
 301 class name : AllStatic {                                                                                                                                       \
 302   private:                                                                                                                                                     \
 303     friend class JVMCICompiler;                                                                                                                                \
 304     static void check(oop obj, const char* field_name, int offset) {                                                                                           \
 305         assert(obj != NULL, "NULL field access of %s.%s", #name, field_name);                                                                                  \
 306         assert(obj-&gt;is_a(SystemDictionary::name##_klass()), "wrong class, " #name " expected, found %s", obj-&gt;klass()-&gt;external_name());                       \
 307         assert(offset != 0, "must be valid offset");                                                                                                           \
 308     }                                                                                                                                                          \
 309     static void compute_offsets(TRAPS);                                                                                                                        \
 310   public:                                                                                                                                                      \
 311     static InstanceKlass* klass() { return SystemDictionary::name##_klass(); }
 312 
 313 #define END_CLASS };
 314 
 315 #define FIELD(name, type, accessor, cast)                                                                                                                         \
 316     static int _##name##_offset;                                                                                                                                  \
 317     static type name(oop obj)                   { check(obj, #name, _##name##_offset); return cast obj-&gt;accessor(_##name##_offset); }                                               \
 318     static type name(Handle obj)                { check(obj(), #name, _##name##_offset); return cast obj-&gt;accessor(_##name##_offset); }                                             \
 319     static type name(jobject obj)               { check(JNIHandles::resolve(obj), #name, _##name##_offset); return cast JNIHandles::resolve(obj)-&gt;accessor(_##name##_offset); }     \
 320     static void set_##name(oop obj, type x)     { check(obj, #name, _##name##_offset); obj-&gt;accessor##_put(_##name##_offset, x); }                                                  \
 321     static void set_##name(Handle obj, type x)  { check(obj(), #name, _##name##_offset); obj-&gt;accessor##_put(_##name##_offset, x); }                                                \
 322     static void set_##name(jobject obj, type x) { check(JNIHandles::resolve(obj), #name, _##name##_offset); JNIHandles::resolve(obj)-&gt;accessor##_put(_##name##_offset, x); }
 323 
 324 #define EMPTY_CAST
 325 #define CHAR_FIELD(klass, name) FIELD(name, jchar, char_field, EMPTY_CAST)
 326 #define INT_FIELD(klass, name) FIELD(name, jint, int_field, EMPTY_CAST)
 327 #define BOOLEAN_FIELD(klass, name) FIELD(name, jboolean, bool_field, EMPTY_CAST)
 328 #define LONG_FIELD(klass, name) FIELD(name, jlong, long_field, EMPTY_CAST)
 329 #define FLOAT_FIELD(klass, name) FIELD(name, jfloat, float_field, EMPTY_CAST)
 330 #define OOP_FIELD(klass, name, signature) FIELD(name, oop, obj_field, EMPTY_CAST)
 331 #define OBJARRAYOOP_FIELD(klass, name, signature) FIELD(name, objArrayOop, obj_field, (objArrayOop))
 332 #define TYPEARRAYOOP_FIELD(klass, name, signature) FIELD(name, typeArrayOop, obj_field, (typeArrayOop))
 333 #define STATIC_OOP_FIELD(klassName, name, signature) STATIC_OOPISH_FIELD(klassName, name, oop, signature)
 334 #define STATIC_OBJARRAYOOP_FIELD(klassName, name, signature) STATIC_OOPISH_FIELD(klassName, name, objArrayOop, signature)
 335 #define STATIC_OOPISH_FIELD(klassName, name, type, signature)                                                  \
 336     static int _##name##_offset;                                                                               \
 337     static type name() {                                                                                       \
 338       assert(klassName::klass() != NULL &amp;&amp; klassName::klass()-&gt;is_linked(), "Class not yet linked: " #klassName); \
 339       InstanceKlass* ik = klassName::klass();                                                                  \
 340       address addr = ik-&gt;static_field_addr(_##name##_offset - InstanceMirrorKlass::offset_of_static_fields()); \
 341       if (UseCompressedOops) {                                                                                 \
 342         return (type) oopDesc::load_decode_heap_oop((narrowOop *)addr);                                        \
 343       } else {                                                                                                 \
 344         return (type) oopDesc::load_decode_heap_oop((oop*)addr);                                               \
 345       }                                                                                                        \
 346     }                                                                                                          \
 347     static void set_##name(type x) {                                                                           \
 348       assert(klassName::klass() != NULL &amp;&amp; klassName::klass()-&gt;is_linked(), "Class not yet linked: " #klassName); \
 349       assert(klassName::klass() != NULL, "Class not yet loaded: " #klassName);                                 \
 350       InstanceKlass* ik = klassName::klass();                                                                  \
 351       address addr = ik-&gt;static_field_addr(_##name##_offset - InstanceMirrorKlass::offset_of_static_fields()); \
 352       if (UseCompressedOops) {                                                                                 \
 353         oop_store((narrowOop *)addr, x);                                                                       \
 354       } else {                                                                                                 \
 355         oop_store((oop*)addr, x);                                                                              \
 356       }                                                                                                        \
 357     }
 358 #define STATIC_PRIMITIVE_FIELD(klassName, name, jtypename)                                                     \
 359     static int _##name##_offset;                                                                               \
 360     static jtypename name() {                                                                                  \
 361       assert(klassName::klass() != NULL &amp;&amp; klassName::klass()-&gt;is_linked(), "Class not yet linked: " #klassName); \
 362       InstanceKlass* ik = klassName::klass();                                                                  \
 363       address addr = ik-&gt;static_field_addr(_##name##_offset - InstanceMirrorKlass::offset_of_static_fields()); \
 364       return *((jtypename *)addr);                                                                             \
 365     }                                                                                                          \
 366     static void set_##name(jtypename x) {                                                                      \
 367       assert(klassName::klass() != NULL &amp;&amp; klassName::klass()-&gt;is_linked(), "Class not yet linked: " #klassName); \
 368       InstanceKlass* ik = klassName::klass();                                                                  \
 369       address addr = ik-&gt;static_field_addr(_##name##_offset - InstanceMirrorKlass::offset_of_static_fields()); \
 370       *((jtypename *)addr) = x;                                                                                \
 371     }
 372 
 373 #define STATIC_INT_FIELD(klassName, name) STATIC_PRIMITIVE_FIELD(klassName, name, jint)
 374 #define STATIC_BOOLEAN_FIELD(klassName, name) STATIC_PRIMITIVE_FIELD(klassName, name, jboolean)
 375 
 376 COMPILER_CLASSES_DO(START_CLASS, END_CLASS, CHAR_FIELD, INT_FIELD, BOOLEAN_FIELD, LONG_FIELD, FLOAT_FIELD, OOP_FIELD, TYPEARRAYOOP_FIELD, OBJARRAYOOP_FIELD, STATIC_OOP_FIELD, STATIC_OBJARRAYOOP_FIELD, STATIC_INT_FIELD, STATIC_BOOLEAN_FIELD)
 377 #undef START_CLASS
 378 #undef END_CLASS
 379 #undef FIELD
 380 #undef CHAR_FIELD
 381 #undef INT_FIELD
 382 #undef BOOLEAN_FIELD
 383 #undef LONG_FIELD
 384 #undef FLOAT_FIELD
 385 #undef OOP_FIELD
 386 #undef TYPEARRAYOOP_FIELD
 387 #undef OBJARRAYOOP_FIELD
 388 #undef STATIC_OOPISH_FIELD
 389 #undef STATIC_OOP_FIELD
 390 #undef STATIC_OBJARRAYOOP_FIELD
 391 #undef STATIC_INT_FIELD
 392 #undef STATIC_BOOLEAN_FIELD
 393 #undef EMPTY_CAST
 394 
 395 void compute_offset(int &amp;dest_offset, Klass* klass, const char* name, const char* signature, bool static_field, TRAPS);
 396 
 397 #endif // SHARE_VM_JVMCI_JVMCIJAVACLASSES_HPP
</pre></body></html>
