<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>Old src/share/vm/jvmci/vmStructs_jvmci.cpp</title>
<body id="SUNWwebrev">
<pre>
   1 /*
   2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  *
  23  */
  24 
  25 #include "precompiled.hpp"
  26 #include "code/codeBlob.hpp"
  27 #include "compiler/abstractCompiler.hpp"
  28 #include "compiler/compileBroker.hpp"
  29 #include "jvmci/jvmciCodeInstaller.hpp"
  30 #include "jvmci/jvmciCompilerToVM.hpp"
  31 #include "jvmci/jvmciEnv.hpp"
  32 #include "jvmci/jvmciRuntime.hpp"
  33 #include "jvmci/vmStructs_jvmci.hpp"
  34 #include "oops/oop.hpp"
  35 #include "oops/objArrayKlass.hpp"
  36 #include "runtime/globals.hpp"
  37 #include "runtime/sharedRuntime.hpp"
  38 #include "runtime/thread.hpp"
  39 #include "runtime/vm_version.hpp"
  40 
  41 #if INCLUDE_ALL_GCS
  42 #include "gc/g1/g1SATBCardTableModRefBS.hpp"
  43 #include "gc/g1/heapRegion.hpp"
  44 #endif
  45 
  46 
  47 #define VM_STRUCTS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field) \
  48   static_field(CompilerToVM::Data,             Klass_vtable_start_offset,              int)                                          \
  49   static_field(CompilerToVM::Data,             Klass_vtable_length_offset,             int)                                          \
  50                                                                                                                                      \
  51   static_field(CompilerToVM::Data,             Method_extra_stack_entries,             int)                                          \
  52                                                                                                                                      \
  53   static_field(CompilerToVM::Data,             SharedRuntime_ic_miss_stub,             address)                                      \
  54   static_field(CompilerToVM::Data,             SharedRuntime_handle_wrong_method_stub, address)                                      \
  55   static_field(CompilerToVM::Data,             SharedRuntime_deopt_blob_unpack,        address)                                      \
  56   static_field(CompilerToVM::Data,             SharedRuntime_deopt_blob_uncommon_trap, address)                                      \
  57                                                                                                                                      \
  58   static_field(CompilerToVM::Data,             ThreadLocalAllocBuffer_alignment_reserve, size_t)                                     \
  59                                                                                                                                      \
  60   static_field(CompilerToVM::Data,             Universe_collectedHeap,                 CollectedHeap*)                               \
  61   static_field(CompilerToVM::Data,             Universe_base_vtable_size,              int)                                          \
  62   static_field(CompilerToVM::Data,             Universe_narrow_oop_base,               address)                                      \
  63   static_field(CompilerToVM::Data,             Universe_narrow_oop_shift,              int)                                          \
  64   static_field(CompilerToVM::Data,             Universe_narrow_klass_base,             address)                                      \
  65   static_field(CompilerToVM::Data,             Universe_narrow_klass_shift,            int)                                          \
  66   static_field(CompilerToVM::Data,             Universe_non_oop_bits,                  void*)                                        \
  67   static_field(CompilerToVM::Data,             Universe_verify_oop_mask,               uintptr_t)                                    \
  68   static_field(CompilerToVM::Data,             Universe_verify_oop_bits,               uintptr_t)                                    \
  69                                                                                                                                      \
  70   static_field(CompilerToVM::Data,             _supports_inline_contig_alloc,          bool)                                         \
  71   static_field(CompilerToVM::Data,             _heap_end_addr,                         HeapWord**)                                   \
  72   static_field(CompilerToVM::Data,             _heap_top_addr,                         HeapWord**)                                   \
  73                                                                                                                                      \
  74   static_field(CompilerToVM::Data,             cardtable_start_address,                jbyte*)                                       \
  75   static_field(CompilerToVM::Data,             cardtable_shift,                        int)                                          \
  76                                                                                                                                      \
  77   static_field(CompilerToVM::Data,             vm_page_size,                           int)                                          \
  78                                                                                                                                      \
  79   static_field(CompilerToVM::Data,             dsin,                                   address)                                      \
  80   static_field(CompilerToVM::Data,             dcos,                                   address)                                      \
  81   static_field(CompilerToVM::Data,             dtan,                                   address)                                      \
  82   static_field(CompilerToVM::Data,             dexp,                                   address)                                      \
  83   static_field(CompilerToVM::Data,             dlog,                                   address)                                      \
  84   static_field(CompilerToVM::Data,             dlog10,                                 address)                                      \
  85   static_field(CompilerToVM::Data,             dpow,                                   address)                                      \
  86                                                                                                                                      \
  87   static_field(Abstract_VM_Version,            _features,                              uint64_t)                                     \
  88                                                                                                                                      \
  89   nonstatic_field(Array&lt;int&gt;,                  _length,                                int)                                          \
  90   unchecked_nonstatic_field(Array&lt;u1&gt;,         _data,                                  sizeof(u1))                                   \
  91   unchecked_nonstatic_field(Array&lt;u2&gt;,         _data,                                  sizeof(u2))                                   \
  92   nonstatic_field(Array&lt;Klass*&gt;,               _length,                                int)                                          \
  93   nonstatic_field(Array&lt;Klass*&gt;,               _data[0],                               Klass*)                                       \
  94                                                                                                                                      \
  95   volatile_nonstatic_field(BasicLock,          _displaced_header,                      markOop)                                      \
  96                                                                                                                                      \
  97   static_field(CodeCache,                      _low_bound,                             address)                                      \
  98   static_field(CodeCache,                      _high_bound,                            address)                                      \
  99                                                                                                                                      \
 100   nonstatic_field(CollectedHeap,               _total_collections,                     unsigned int)                                 \
 101                                                                                                                                      \
 102   nonstatic_field(CompileTask,                 _num_inlined_bytecodes,                 int)                                          \
 103                                                                                                                                      \
 104   nonstatic_field(ConstantPool,                _tags,                                  Array&lt;u1&gt;*)                                   \
 105   nonstatic_field(ConstantPool,                _pool_holder,                           InstanceKlass*)                               \
 106   nonstatic_field(ConstantPool,                _length,                                int)                                          \
 107                                                                                                                                      \
 108   nonstatic_field(ConstMethod,                 _constants,                             ConstantPool*)                                \
 109   nonstatic_field(ConstMethod,                 _flags,                                 u2)                                           \
 110   nonstatic_field(ConstMethod,                 _code_size,                             u2)                                           \
 111   nonstatic_field(ConstMethod,                 _name_index,                            u2)                                           \
 112   nonstatic_field(ConstMethod,                 _signature_index,                       u2)                                           \
 113   nonstatic_field(ConstMethod,                 _max_stack,                             u2)                                           \
 114   nonstatic_field(ConstMethod,                 _max_locals,                            u2)                                           \
 115                                                                                                                                      \
 116   nonstatic_field(DataLayout,                  _header._struct._tag,                   u1)                                           \
 117   nonstatic_field(DataLayout,                  _header._struct._flags,                 u1)                                           \
 118   nonstatic_field(DataLayout,                  _header._struct._bci,                   u2)                                           \
 119   nonstatic_field(DataLayout,                  _cells[0],                              intptr_t)                                     \
 120                                                                                                                                      \
 121   nonstatic_field(Deoptimization::UnrollBlock, _size_of_deoptimized_frame,             int)                                          \
 122   nonstatic_field(Deoptimization::UnrollBlock, _caller_adjustment,                     int)                                          \
 123   nonstatic_field(Deoptimization::UnrollBlock, _number_of_frames,                      int)                                          \
 124   nonstatic_field(Deoptimization::UnrollBlock, _total_frame_sizes,                     int)                                          \
 125   nonstatic_field(Deoptimization::UnrollBlock, _frame_sizes,                           intptr_t*)                                    \
 126   nonstatic_field(Deoptimization::UnrollBlock, _frame_pcs,                             address*)                                     \
 127   nonstatic_field(Deoptimization::UnrollBlock, _initial_info,                          intptr_t)                                     \
 128   nonstatic_field(Deoptimization::UnrollBlock, _unpack_kind,                           int)                                          \
 129                                                                                                                                      \
 130   nonstatic_field(ExceptionTableElement,       start_pc,                                       u2)                                   \
 131   nonstatic_field(ExceptionTableElement,       end_pc,                                         u2)                                   \
 132   nonstatic_field(ExceptionTableElement,       handler_pc,                                     u2)                                   \
 133   nonstatic_field(ExceptionTableElement,       catch_type_index,                               u2)                                   \
 134                                                                                                                                      \
 135   nonstatic_field(Flag,                        _type,                                          const char*)                          \
 136   nonstatic_field(Flag,                        _name,                                          const char*)                          \
 137   unchecked_nonstatic_field(Flag,              _addr,                                          sizeof(void*))                        \
 138   nonstatic_field(Flag,                        _flags,                                         Flag::Flags)                          \
 139   static_field(Flag,                           flags,                                          Flag*)                                \
 140                                                                                                                                      \
 141   nonstatic_field(InstanceKlass,               _fields,                                       Array&lt;u2&gt;*)                            \
 142   nonstatic_field(InstanceKlass,               _constants,                                    ConstantPool*)                         \
 143   nonstatic_field(InstanceKlass,               _source_file_name_index,                       u2)                                    \
 144   nonstatic_field(InstanceKlass,               _init_state,                                   u1)                                    \
 145                                                                                                                                      \
 146   volatile_nonstatic_field(JavaFrameAnchor,    _last_Java_sp,                                 intptr_t*)                             \
 147   volatile_nonstatic_field(JavaFrameAnchor,    _last_Java_pc,                                 address)                               \
 148                                                                                                                                      \
 149   nonstatic_field(JavaThread,                  _threadObj,                                    oop)                                   \
 150   nonstatic_field(JavaThread,                  _anchor,                                       JavaFrameAnchor)                       \
 151   nonstatic_field(JavaThread,                  _vm_result,                                    oop)                                   \
 152   volatile_nonstatic_field(JavaThread,         _exception_oop,                                oop)                                   \
 153   volatile_nonstatic_field(JavaThread,         _exception_pc,                                 address)                               \
 154   volatile_nonstatic_field(JavaThread,         _is_method_handle_return,                      int)                                   \
 155   nonstatic_field(JavaThread,                  _osthread,                                     OSThread*)                             \
 156   nonstatic_field(JavaThread,                  _satb_mark_queue,                              SATBMarkQueue)                         \
 157   nonstatic_field(JavaThread,                  _dirty_card_queue,                             DirtyCardQueue)                        \
 158   nonstatic_field(JavaThread,                  _pending_deoptimization,                       int)                                   \
 159   nonstatic_field(JavaThread,                  _pending_failed_speculation,                   oop)                                   \
 160   nonstatic_field(JavaThread,                  _pending_transfer_to_interpreter,              bool)                                  \
 161   nonstatic_field(JavaThread,                  _jvmci_counters,                               jlong*)                                \
 162   nonstatic_field(JavaThread,                  _reserved_stack_activation,                    address)                               \
 163                                                                                                                                      \
 164   static_field(java_lang_Class,                _klass_offset,                                 int)                                   \
 165   static_field(java_lang_Class,                _array_klass_offset,                           int)                                   \
 166                                                                                                                                      \
 167   nonstatic_field(JVMCIEnv,                    _task,                                         CompileTask*)                          \
 168   nonstatic_field(JVMCIEnv,                    _jvmti_can_hotswap_or_post_breakpoint,         bool)                                  \
 169                                                                                                                                      \
 170   nonstatic_field(Klass,                       _secondary_super_cache,                        Klass*)                                \
 171   nonstatic_field(Klass,                       _secondary_supers,                             Array&lt;Klass*&gt;*)                        \
 172   nonstatic_field(Klass,                       _super,                                        Klass*)                                \
 173   nonstatic_field(Klass,                       _super_check_offset,                           juint)                                 \
 174   nonstatic_field(Klass,                       _subklass,                                     Klass*)                                \
 175   nonstatic_field(Klass,                       _layout_helper,                                jint)                                  \
 176   nonstatic_field(Klass,                       _name,                                         Symbol*)                               \
 177   nonstatic_field(Klass,                       _prototype_header,                             markOop)                               \
 178   nonstatic_field(Klass,                       _next_sibling,                                 Klass*)                                \
 179   nonstatic_field(Klass,                       _java_mirror,                                  oop)                                   \
 180   nonstatic_field(Klass,                       _modifier_flags,                               jint)                                  \
 181   nonstatic_field(Klass,                       _access_flags,                                 AccessFlags)                           \
 182                                                                                                                                      \
 183   nonstatic_field(LocalVariableTableElement,   start_bci,                                     u2)                                    \
 184   nonstatic_field(LocalVariableTableElement,   length,                                        u2)                                    \
 185   nonstatic_field(LocalVariableTableElement,   name_cp_index,                                 u2)                                    \
 186   nonstatic_field(LocalVariableTableElement,   descriptor_cp_index,                           u2)                                    \
 187   nonstatic_field(LocalVariableTableElement,   signature_cp_index,                            u2)                                    \
 188   nonstatic_field(LocalVariableTableElement,   slot,                                          u2)                                    \
 189                                                                                                                                      \
 190   nonstatic_field(Method,                      _constMethod,                                  ConstMethod*)                          \
 191   nonstatic_field(Method,                      _method_data,                                  MethodData*)                           \
 192   nonstatic_field(Method,                      _method_counters,                              MethodCounters*)                       \
 193   nonstatic_field(Method,                      _access_flags,                                 AccessFlags)                           \
 194   nonstatic_field(Method,                      _vtable_index,                                 int)                                   \
 195   nonstatic_field(Method,                      _intrinsic_id,                                 u2)                                    \
 196   nonstatic_field(Method,                      _flags,                                        u2)                                    \
 197   volatile_nonstatic_field(Method,             _code,                                         CompiledMethod*)                       \
 198   volatile_nonstatic_field(Method,             _from_compiled_entry,                          address)                               \
 199                                                                                                                                      \
 200   nonstatic_field(MethodCounters,              _invocation_counter,                           InvocationCounter)                     \
 201   nonstatic_field(MethodCounters,              _backedge_counter,                             InvocationCounter)                     \
 202                                                                                                                                      \
 203   nonstatic_field(MethodData,                  _size,                                         int)                                   \
 204   nonstatic_field(MethodData,                  _data_size,                                    int)                                   \
 205   nonstatic_field(MethodData,                  _data[0],                                      intptr_t)                              \
 206   nonstatic_field(MethodData,                  _trap_hist._array[0],                          u1)                                    \
 207   nonstatic_field(MethodData,                  _jvmci_ir_size,                                int)                                   \
 208                                                                                                                                      \
 209   nonstatic_field(nmethod,                     _verified_entry_point,                         address)                               \
 210   nonstatic_field(nmethod,                     _comp_level,                                   int)                                   \
 211                                                                                                                                      \
 212   nonstatic_field(ObjArrayKlass,               _element_klass,                                Klass*)                                \
 213                                                                                                                                      \
 214   volatile_nonstatic_field(oopDesc,            _mark,                                         markOop)                               \
 215   volatile_nonstatic_field(oopDesc,            _metadata._klass,                              Klass*)                                \
 216                                                                                                                                      \
 217   static_field(os,                             _polling_page,                                 address)                               \
 218                                                                                                                                      \
 219   volatile_nonstatic_field(OSThread,           _interrupted,                                  jint)                                  \
 220                                                                                                                                      \
 221   static_field(StubRoutines,                _verify_oop_count,                                jint)                                  \
 222                                                                                                                                      \
 223   static_field(StubRoutines,                _throw_delayed_StackOverflowError_entry,          address)                               \
 224                                                                                                                                      \
 225   static_field(StubRoutines,                _jbyte_arraycopy,                                 address)                               \
 226   static_field(StubRoutines,                _jshort_arraycopy,                                address)                               \
 227   static_field(StubRoutines,                _jint_arraycopy,                                  address)                               \
 228   static_field(StubRoutines,                _jlong_arraycopy,                                 address)                               \
 229   static_field(StubRoutines,                _oop_arraycopy,                                   address)                               \
 230   static_field(StubRoutines,                _oop_arraycopy_uninit,                            address)                               \
 231   static_field(StubRoutines,                _jbyte_disjoint_arraycopy,                        address)                               \
 232   static_field(StubRoutines,                _jshort_disjoint_arraycopy,                       address)                               \
 233   static_field(StubRoutines,                _jint_disjoint_arraycopy,                         address)                               \
 234   static_field(StubRoutines,                _jlong_disjoint_arraycopy,                        address)                               \
 235   static_field(StubRoutines,                _oop_disjoint_arraycopy,                          address)                               \
 236   static_field(StubRoutines,                _oop_disjoint_arraycopy_uninit,                   address)                               \
 237   static_field(StubRoutines,                _arrayof_jbyte_arraycopy,                         address)                               \
 238   static_field(StubRoutines,                _arrayof_jshort_arraycopy,                        address)                               \
 239   static_field(StubRoutines,                _arrayof_jint_arraycopy,                          address)                               \
 240   static_field(StubRoutines,                _arrayof_jlong_arraycopy,                         address)                               \
 241   static_field(StubRoutines,                _arrayof_oop_arraycopy,                           address)                               \
 242   static_field(StubRoutines,                _arrayof_oop_arraycopy_uninit,                    address)                               \
 243   static_field(StubRoutines,                _arrayof_jbyte_disjoint_arraycopy,                address)                               \
 244   static_field(StubRoutines,                _arrayof_jshort_disjoint_arraycopy,               address)                               \
 245   static_field(StubRoutines,                _arrayof_jint_disjoint_arraycopy,                 address)                               \
 246   static_field(StubRoutines,                _arrayof_jlong_disjoint_arraycopy,                address)                               \
 247   static_field(StubRoutines,                _arrayof_oop_disjoint_arraycopy,                  address)                               \
 248   static_field(StubRoutines,                _arrayof_oop_disjoint_arraycopy_uninit,           address)                               \
 249   static_field(StubRoutines,                _checkcast_arraycopy,                             address)                               \
 250   static_field(StubRoutines,                _checkcast_arraycopy_uninit,                      address)                               \
 251   static_field(StubRoutines,                _unsafe_arraycopy,                                address)                               \
 252   static_field(StubRoutines,                _generic_arraycopy,                               address)                               \
 253                                                                                                                                      \
 254   static_field(StubRoutines,                _aescrypt_encryptBlock,                           address)                               \
 255   static_field(StubRoutines,                _aescrypt_decryptBlock,                           address)                               \
 256   static_field(StubRoutines,                _cipherBlockChaining_encryptAESCrypt,             address)                               \
 257   static_field(StubRoutines,                _cipherBlockChaining_decryptAESCrypt,             address)                               \
 258   static_field(StubRoutines,                _updateBytesCRC32,                                address)                               \
 259   static_field(StubRoutines,                _crc_table_adr,                                   address)                               \
 260                                                                                                                                      \
 261   nonstatic_field(Thread,                   _tlab,                                            ThreadLocalAllocBuffer)                \
 262   nonstatic_field(Thread,                   _allocated_bytes,                                 jlong)                                 \
 263                                                                                                                                      \
 264   nonstatic_field(ThreadLocalAllocBuffer,   _start,                                           HeapWord*)                             \
 265   nonstatic_field(ThreadLocalAllocBuffer,   _top,                                             HeapWord*)                             \
 266   nonstatic_field(ThreadLocalAllocBuffer,   _end,                                             HeapWord*)                             \
 267   nonstatic_field(ThreadLocalAllocBuffer,   _pf_top,                                          HeapWord*)                             \
 268   nonstatic_field(ThreadLocalAllocBuffer,   _desired_size,                                    size_t)                                \
 269   nonstatic_field(ThreadLocalAllocBuffer,   _refill_waste_limit,                              size_t)                                \
 270   nonstatic_field(ThreadLocalAllocBuffer,   _number_of_refills,                               unsigned)                              \
 271   nonstatic_field(ThreadLocalAllocBuffer,   _fast_refill_waste,                               unsigned)                              \
 272   nonstatic_field(ThreadLocalAllocBuffer,   _slow_allocations,                                unsigned)                              \
 273                                                                                                                                      \
 274   nonstatic_field(ThreadShadow,             _pending_exception,                               oop)                                   \
 275                                                                                                                                      \
 276   static_field(vmSymbols,                   _symbols[0],                                      Symbol*)                               \
 277                                                                                                                                      \
 278   nonstatic_field(vtableEntry,              _method,                                          Method*)                               \
 279 
 280 #define VM_TYPES(declare_type, declare_toplevel_type, declare_integer_type, declare_unsigned_integer_type) \
 281   declare_integer_type(bool)                                              \
 282   declare_unsigned_integer_type(size_t)                                   \
 283   declare_integer_type(intx)                                              \
 284   declare_unsigned_integer_type(uintx)                                    \
 285                                                                           \
 286   declare_toplevel_type(BasicLock)                                        \
 287   declare_toplevel_type(CompilerToVM)                                     \
 288   declare_toplevel_type(ExceptionTableElement)                            \
 289   declare_toplevel_type(Flag)                                             \
 290   declare_toplevel_type(Flag*)                                            \
 291   declare_toplevel_type(JVMCIEnv)                                         \
 292   declare_toplevel_type(LocalVariableTableElement)                        \
 293   declare_toplevel_type(narrowKlass)                                      \
 294   declare_toplevel_type(Symbol*)                                          \
 295   declare_toplevel_type(vtableEntry)                                      \
 296                                                                           \
 297   declare_toplevel_type(oopDesc)                                          \
 298     declare_type(arrayOopDesc, oopDesc)                                   \
 299                                                                           \
 300   declare_toplevel_type(MetaspaceObj)                                     \
 301     declare_type(Metadata, MetaspaceObj)                                  \
 302     declare_type(Klass, Metadata)                                         \
 303       declare_type(InstanceKlass, Klass)                                  \
 304     declare_type(ConstantPool, Metadata)                                  \
 305 
 306 #define VM_INT_CONSTANTS(declare_constant, declare_constant_with_value, declare_preprocessor_constant) \
 307   declare_preprocessor_constant("ASSERT", DEBUG_ONLY(1) NOT_DEBUG(0))     \
 308   declare_preprocessor_constant("FIELDINFO_TAG_SIZE", FIELDINFO_TAG_SIZE) \
 309   declare_preprocessor_constant("STACK_BIAS", STACK_BIAS)                 \
 310                                                                           \
 311   declare_constant(CompLevel_full_optimization)                           \
 312   declare_constant(HeapWordSize)                                          \
 313   declare_constant(InvocationEntryBci)                                    \
 314   declare_constant(LogKlassAlignmentInBytes)                              \
 315                                                                           \
 316   declare_constant(JVM_ACC_WRITTEN_FLAGS)                                 \
 317   declare_constant(JVM_ACC_MONITOR_MATCH)                                 \
 318   declare_constant(JVM_ACC_HAS_MONITOR_BYTECODES)                         \
 319   declare_constant(JVM_ACC_HAS_FINALIZER)                                 \
 320   declare_constant(JVM_ACC_IS_CLONEABLE_FAST)                             \
 321   declare_constant(JVM_ACC_FIELD_INTERNAL)                                \
 322   declare_constant(JVM_ACC_FIELD_STABLE)                                  \
 323   declare_constant(JVM_ACC_FIELD_HAS_GENERIC_SIGNATURE)                   \
 324   declare_preprocessor_constant("JVM_ACC_SYNTHETIC", JVM_ACC_SYNTHETIC)   \
 325   declare_preprocessor_constant("JVM_RECOGNIZED_FIELD_MODIFIERS", JVM_RECOGNIZED_FIELD_MODIFIERS) \
 326                                                                           \
 327   declare_constant(JVM_CONSTANT_Utf8)                                     \
 328   declare_constant(JVM_CONSTANT_Unicode)                                  \
 329   declare_constant(JVM_CONSTANT_Integer)                                  \
 330   declare_constant(JVM_CONSTANT_Float)                                    \
 331   declare_constant(JVM_CONSTANT_Long)                                     \
 332   declare_constant(JVM_CONSTANT_Double)                                   \
 333   declare_constant(JVM_CONSTANT_Class)                                    \
 334   declare_constant(JVM_CONSTANT_String)                                   \
 335   declare_constant(JVM_CONSTANT_Fieldref)                                 \
 336   declare_constant(JVM_CONSTANT_Methodref)                                \
 337   declare_constant(JVM_CONSTANT_InterfaceMethodref)                       \
 338   declare_constant(JVM_CONSTANT_NameAndType)                              \
 339   declare_constant(JVM_CONSTANT_MethodHandle)                             \
 340   declare_constant(JVM_CONSTANT_MethodType)                               \
 341   declare_constant(JVM_CONSTANT_InvokeDynamic)                            \
 342   declare_constant(JVM_CONSTANT_ExternalMax)                              \
 343                                                                           \
 344   declare_constant(JVM_CONSTANT_Invalid)                                  \
 345   declare_constant(JVM_CONSTANT_InternalMin)                              \
 346   declare_constant(JVM_CONSTANT_UnresolvedClass)                          \
 347   declare_constant(JVM_CONSTANT_ClassIndex)                               \
 348   declare_constant(JVM_CONSTANT_StringIndex)                              \
 349   declare_constant(JVM_CONSTANT_UnresolvedClassInError)                   \
 350   declare_constant(JVM_CONSTANT_MethodHandleInError)                      \
 351   declare_constant(JVM_CONSTANT_MethodTypeInError)                        \
 352   declare_constant(JVM_CONSTANT_InternalMax)                              \
 353                                                                           \
 354   declare_constant(ArrayData::array_len_off_set)                          \
 355   declare_constant(ArrayData::array_start_off_set)                        \
 356                                                                           \
 357   declare_constant(BitData::exception_seen_flag)                          \
 358   declare_constant(BitData::null_seen_flag)                               \
 359   declare_constant(BranchData::not_taken_off_set)                         \
 360                                                                           \
 361   declare_constant_with_value("CardTableModRefBS::dirty_card", CardTableModRefBS::dirty_card_val()) \
 362                                                                           \
 363   declare_constant(CodeInstaller::VERIFIED_ENTRY)                         \
 364   declare_constant(CodeInstaller::UNVERIFIED_ENTRY)                       \
 365   declare_constant(CodeInstaller::OSR_ENTRY)                              \
 366   declare_constant(CodeInstaller::EXCEPTION_HANDLER_ENTRY)                \
 367   declare_constant(CodeInstaller::DEOPT_HANDLER_ENTRY)                    \
 368   declare_constant(CodeInstaller::INVOKEINTERFACE)                        \
 369   declare_constant(CodeInstaller::INVOKEVIRTUAL)                          \
 370   declare_constant(CodeInstaller::INVOKESTATIC)                           \
 371   declare_constant(CodeInstaller::INVOKESPECIAL)                          \
 372   declare_constant(CodeInstaller::INLINE_INVOKE)                          \
 373   declare_constant(CodeInstaller::POLL_NEAR)                              \
 374   declare_constant(CodeInstaller::POLL_RETURN_NEAR)                       \
 375   declare_constant(CodeInstaller::POLL_FAR)                               \
 376   declare_constant(CodeInstaller::POLL_RETURN_FAR)                        \
 377   declare_constant(CodeInstaller::CARD_TABLE_SHIFT)                       \
 378   declare_constant(CodeInstaller::CARD_TABLE_ADDRESS)                     \
 379   declare_constant(CodeInstaller::HEAP_TOP_ADDRESS)                       \
 380   declare_constant(CodeInstaller::HEAP_END_ADDRESS)                       \
 381   declare_constant(CodeInstaller::NARROW_KLASS_BASE_ADDRESS)              \
 382   declare_constant(CodeInstaller::CRC_TABLE_ADDRESS)                      \
 383   declare_constant(CodeInstaller::INVOKE_INVALID)                         \
 384                                                                           \
 385   declare_constant(ConstantPool::CPCACHE_INDEX_TAG)                       \
 386                                                                           \
 387   declare_constant(ConstMethod::_has_linenumber_table)                    \
 388   declare_constant(ConstMethod::_has_localvariable_table)                 \
 389   declare_constant(ConstMethod::_has_exception_table)                     \
 390                                                                           \
 391   declare_constant(CounterData::count_off)                                \
 392                                                                           \
 393   declare_constant(DataLayout::cell_size)                                 \
 394   declare_constant(DataLayout::no_tag)                                    \
 395   declare_constant(DataLayout::bit_data_tag)                              \
 396   declare_constant(DataLayout::counter_data_tag)                          \
 397   declare_constant(DataLayout::jump_data_tag)                             \
 398   declare_constant(DataLayout::receiver_type_data_tag)                    \
 399   declare_constant(DataLayout::virtual_call_data_tag)                     \
 400   declare_constant(DataLayout::ret_data_tag)                              \
 401   declare_constant(DataLayout::branch_data_tag)                           \
 402   declare_constant(DataLayout::multi_branch_data_tag)                     \
 403   declare_constant(DataLayout::arg_info_data_tag)                         \
 404   declare_constant(DataLayout::call_type_data_tag)                        \
 405   declare_constant(DataLayout::virtual_call_type_data_tag)                \
 406   declare_constant(DataLayout::parameters_type_data_tag)                  \
 407   declare_constant(DataLayout::speculative_trap_data_tag)                 \
 408                                                                           \
 409   declare_constant(Deoptimization::Unpack_deopt)                          \
 410   declare_constant(Deoptimization::Unpack_exception)                      \
 411   declare_constant(Deoptimization::Unpack_uncommon_trap)                  \
 412   declare_constant(Deoptimization::Unpack_reexecute)                      \
 413                                                                           \
 414   declare_constant(Deoptimization::_action_bits)                          \
 415   declare_constant(Deoptimization::_reason_bits)                          \
 416   declare_constant(Deoptimization::_debug_id_bits)                        \
 417   declare_constant(Deoptimization::_action_shift)                         \
 418   declare_constant(Deoptimization::_reason_shift)                         \
 419   declare_constant(Deoptimization::_debug_id_shift)                       \
 420                                                                           \
 421   declare_constant(Deoptimization::Action_none)                           \
 422   declare_constant(Deoptimization::Action_maybe_recompile)                \
 423   declare_constant(Deoptimization::Action_reinterpret)                    \
 424   declare_constant(Deoptimization::Action_make_not_entrant)               \
 425   declare_constant(Deoptimization::Action_make_not_compilable)            \
 426                                                                           \
 427   declare_constant(Deoptimization::Reason_none)                           \
 428   declare_constant(Deoptimization::Reason_null_check)                     \
 429   declare_constant(Deoptimization::Reason_range_check)                    \
 430   declare_constant(Deoptimization::Reason_class_check)                    \
 431   declare_constant(Deoptimization::Reason_array_check)                    \
 432   declare_constant(Deoptimization::Reason_unreached0)                     \
 433   declare_constant(Deoptimization::Reason_constraint)                     \
 434   declare_constant(Deoptimization::Reason_div0_check)                     \
 435   declare_constant(Deoptimization::Reason_loop_limit_check)               \
 436   declare_constant(Deoptimization::Reason_type_checked_inlining)          \
 437   declare_constant(Deoptimization::Reason_optimized_type_check)           \
 438   declare_constant(Deoptimization::Reason_aliasing)                       \
 439   declare_constant(Deoptimization::Reason_transfer_to_interpreter)        \
 440   declare_constant(Deoptimization::Reason_not_compiled_exception_handler) \
 441   declare_constant(Deoptimization::Reason_unresolved)                     \
 442   declare_constant(Deoptimization::Reason_jsr_mismatch)                   \
 443   declare_constant(Deoptimization::Reason_LIMIT)                          \
 444                                                                           \
 445   declare_constant_with_value("dirtyCardQueueBufferOffset", in_bytes(DirtyCardQueue::byte_offset_of_buf())) \
 446   declare_constant_with_value("dirtyCardQueueIndexOffset", in_bytes(DirtyCardQueue::byte_offset_of_index())) \
 447                                                                           \
 448   declare_constant(FieldInfo::access_flags_offset)                        \
 449   declare_constant(FieldInfo::name_index_offset)                          \
 450   declare_constant(FieldInfo::signature_index_offset)                     \
 451   declare_constant(FieldInfo::initval_index_offset)                       \
 452   declare_constant(FieldInfo::low_packed_offset)                          \
 453   declare_constant(FieldInfo::high_packed_offset)                         \
 454   declare_constant(FieldInfo::field_slots)                                \
 455                                                                           \
 456   declare_constant(InstanceKlass::linked)                                 \
 457   declare_constant(InstanceKlass::fully_initialized)                      \
 458                                                                           \
 459   declare_constant(JumpData::taken_off_set)                               \
 460   declare_constant(JumpData::displacement_off_set)                        \
 461                                                                           \
 462   declare_constant(JVMCIEnv::ok)                                          \
 463   declare_constant(JVMCIEnv::dependencies_failed)                         \
 464   declare_constant(JVMCIEnv::dependencies_invalid)                        \
 465   declare_constant(JVMCIEnv::cache_full)                                  \
 466   declare_constant(JVMCIEnv::code_too_large)                              \
 467                                                                           \
 468   declare_constant(Klass::_lh_neutral_value)                              \
 469   declare_constant(Klass::_lh_instance_slow_path_bit)                     \
 470   declare_constant(Klass::_lh_log2_element_size_shift)                    \
 471   declare_constant(Klass::_lh_log2_element_size_mask)                     \
 472   declare_constant(Klass::_lh_element_type_shift)                         \
 473   declare_constant(Klass::_lh_element_type_mask)                          \
 474   declare_constant(Klass::_lh_header_size_shift)                          \
 475   declare_constant(Klass::_lh_header_size_mask)                           \
 476   declare_constant(Klass::_lh_array_tag_shift)                            \
 477   declare_constant(Klass::_lh_array_tag_type_value)                       \
 478   declare_constant(Klass::_lh_array_tag_obj_value)                        \
 479                                                                           \
 480   declare_constant(markOopDesc::no_hash)                                  \
 481                                                                           \
 482   declare_constant(Method::_jfr_towrite)                                  \
 483   declare_constant(Method::_caller_sensitive)                             \
 484   declare_constant(Method::_force_inline)                                 \
 485   declare_constant(Method::_dont_inline)                                  \
 486   declare_constant(Method::_hidden)                                       \
 487   declare_constant(Method::_reserved_stack_access)                        \
 488                                                                           \
 489   declare_constant(Method::nonvirtual_vtable_index)                       \
 490   declare_constant(Method::invalid_vtable_index)                          \
 491                                                                           \
 492   declare_constant(MultiBranchData::per_case_cell_count)                  \
 493                                                                           \
 494   declare_constant(ReceiverTypeData::nonprofiled_count_off_set)           \
 495   declare_constant(ReceiverTypeData::receiver_type_row_cell_count)        \
 496   declare_constant(ReceiverTypeData::receiver0_offset)                    \
 497   declare_constant(ReceiverTypeData::count0_offset)                       \
 498                                                                           \
 499   declare_constant_with_value("satbMarkQueueBufferOffset", in_bytes(SATBMarkQueue::byte_offset_of_buf())) \
 500   declare_constant_with_value("satbMarkQueueIndexOffset", in_bytes(SATBMarkQueue::byte_offset_of_index())) \
 501   declare_constant_with_value("satbMarkQueueActiveOffset", in_bytes(SATBMarkQueue::byte_offset_of_active())) \
 502                                                                           \
 503   declare_constant(vmIntrinsics::_invokeBasic)                            \
 504   declare_constant(vmIntrinsics::_linkToVirtual)                          \
 505   declare_constant(vmIntrinsics::_linkToStatic)                           \
 506   declare_constant(vmIntrinsics::_linkToSpecial)                          \
 507   declare_constant(vmIntrinsics::_linkToInterface)                        \
 508                                                                           \
 509   declare_constant(vmSymbols::FIRST_SID)                                  \
 510   declare_constant(vmSymbols::SID_LIMIT)                                  \
 511 
 512 #define VM_LONG_CONSTANTS(declare_constant, declare_preprocessor_constant) \
 513   declare_constant(InvocationCounter::count_increment)                    \
 514   declare_constant(InvocationCounter::count_shift)                        \
 515                                                                           \
 516   declare_constant(markOopDesc::hash_shift)                               \
 517                                                                           \
 518   declare_constant(markOopDesc::biased_lock_mask_in_place)                \
 519   declare_constant(markOopDesc::age_mask_in_place)                        \
 520   declare_constant(markOopDesc::epoch_mask_in_place)                      \
 521   declare_constant(markOopDesc::hash_mask)                                \
 522   declare_constant(markOopDesc::hash_mask_in_place)                       \
 523                                                                           \
 524   declare_constant(markOopDesc::unlocked_value)                           \
 525   declare_constant(markOopDesc::biased_lock_pattern)                      \
 526                                                                           \
 527   declare_constant(markOopDesc::no_hash_in_place)                         \
 528   declare_constant(markOopDesc::no_lock_in_place)                         \
 529 
 530 #define VM_ADDRESSES(declare_address, declare_preprocessor_address, declare_function) \
 531   declare_function(SharedRuntime::register_finalizer)                     \
 532   declare_function(SharedRuntime::exception_handler_for_return_address)   \
 533   declare_function(SharedRuntime::OSR_migration_end)                      \
 534   declare_function(SharedRuntime::enable_stack_reserved_zone)             \
 535                                                                           \
 536   declare_function(os::dll_load)                                          \
 537   declare_function(os::dll_lookup)                                        \
 538   declare_function(os::javaTimeMillis)                                    \
 539   declare_function(os::javaTimeNanos)                                     \
 540                                                                           \
 541   declare_function(Deoptimization::fetch_unroll_info)                     \
 542   COMPILER2_PRESENT(declare_function(Deoptimization::uncommon_trap))      \
 543   declare_function(Deoptimization::unpack_frames)                         \
 544                                                                           \
 545   declare_function(JVMCIRuntime::new_instance) \
 546   declare_function(JVMCIRuntime::new_array) \
 547   declare_function(JVMCIRuntime::new_multi_array) \
 548   declare_function(JVMCIRuntime::dynamic_new_array) \
 549   declare_function(JVMCIRuntime::dynamic_new_instance) \
 550   \
 551   declare_function(JVMCIRuntime::thread_is_interrupted) \
 552   declare_function(JVMCIRuntime::vm_message) \
 553   declare_function(JVMCIRuntime::identity_hash_code) \
 554   declare_function(JVMCIRuntime::exception_handler_for_pc) \
 555   declare_function(JVMCIRuntime::monitorenter) \
 556   declare_function(JVMCIRuntime::monitorexit) \
 557   declare_function(JVMCIRuntime::throw_and_post_jvmti_exception) \
 558   declare_function(JVMCIRuntime::throw_klass_external_name_exception) \
 559   declare_function(JVMCIRuntime::throw_class_cast_exception) \
 560   declare_function(JVMCIRuntime::log_primitive) \
 561   declare_function(JVMCIRuntime::log_object) \
 562   declare_function(JVMCIRuntime::log_printf) \
 563   declare_function(JVMCIRuntime::vm_error) \
 564   declare_function(JVMCIRuntime::load_and_clear_exception) \
 565   declare_function(JVMCIRuntime::write_barrier_pre) \
 566   declare_function(JVMCIRuntime::write_barrier_post) \
 567   declare_function(JVMCIRuntime::validate_object) \
 568   \
 569   declare_function(JVMCIRuntime::test_deoptimize_call_int)
 570 
 571 
 572 #if INCLUDE_ALL_GCS
 573 
 574 #define VM_STRUCTS_G1(nonstatic_field, static_field) \
 575   static_field(HeapRegion, LogOfHRGrainBytes, int)
 576 
 577 #define VM_INT_CONSTANTS_G1(declare_constant, declare_constant_with_value, declare_preprocessor_constant) \
 578   declare_constant_with_value("G1SATBCardTableModRefBS::g1_young_gen", G1SATBCardTableModRefBS::g1_young_card_val())
 579 
 580 #endif // INCLUDE_ALL_GCS
 581 
 582 
 583 #ifdef TARGET_OS_FAMILY_linux
 584 
 585 #define VM_ADDRESSES_OS(declare_address, declare_preprocessor_address, declare_function) \
 586   declare_preprocessor_address("RTLD_DEFAULT", RTLD_DEFAULT)
 587 
 588 #endif // TARGET_OS_FAMILY_linux
 589 
 590 
 591 #ifdef TARGET_OS_FAMILY_bsd
 592 
 593 #define VM_ADDRESSES_OS(declare_address, declare_preprocessor_address, declare_function) \
 594   declare_preprocessor_address("RTLD_DEFAULT", RTLD_DEFAULT)
 595 
 596 #endif // TARGET_OS_FAMILY_bsd
 597 
 598 
 599 #ifdef TARGET_ARCH_aarch64
 600 
 601 #define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field, unchecked_c1_static_field, unchecked_c2_static_field) \
 602   volatile_nonstatic_field(JavaFrameAnchor, _last_Java_fp, intptr_t*)
 603 
 604 #endif // TARGET_ARCH_aarch64
 605 
 606 
 607 #ifdef TARGET_ARCH_x86
 608 
 609 #define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field, unchecked_c1_static_field, unchecked_c2_static_field) \
 610   volatile_nonstatic_field(JavaFrameAnchor, _last_Java_fp, intptr_t*)
 611 
 612 #define VM_INT_CONSTANTS_CPU(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant) \
 613   LP64_ONLY(declare_constant(frame::arg_reg_save_area_bytes))       \
 614   declare_constant(frame::interpreter_frame_sender_sp_offset)       \
 615   declare_constant(frame::interpreter_frame_last_sp_offset)         \
 616   declare_constant(VM_Version::CPU_CX8)                             \
 617   declare_constant(VM_Version::CPU_CMOV)                            \
 618   declare_constant(VM_Version::CPU_FXSR)                            \
 619   declare_constant(VM_Version::CPU_HT)                              \
 620   declare_constant(VM_Version::CPU_MMX)                             \
 621   declare_constant(VM_Version::CPU_3DNOW_PREFETCH)                  \
 622   declare_constant(VM_Version::CPU_SSE)                             \
 623   declare_constant(VM_Version::CPU_SSE2)                            \
 624   declare_constant(VM_Version::CPU_SSE3)                            \
 625   declare_constant(VM_Version::CPU_SSSE3)                           \
 626   declare_constant(VM_Version::CPU_SSE4A)                           \
 627   declare_constant(VM_Version::CPU_SSE4_1)                          \
 628   declare_constant(VM_Version::CPU_SSE4_2)                          \
 629   declare_constant(VM_Version::CPU_POPCNT)                          \
 630   declare_constant(VM_Version::CPU_LZCNT)                           \
 631   declare_constant(VM_Version::CPU_TSC)                             \
 632   declare_constant(VM_Version::CPU_TSCINV)                          \
 633   declare_constant(VM_Version::CPU_AVX)                             \
 634   declare_constant(VM_Version::CPU_AVX2)                            \
 635   declare_constant(VM_Version::CPU_AES)                             \
 636   declare_constant(VM_Version::CPU_ERMS)                            \
 637   declare_constant(VM_Version::CPU_CLMUL)                           \
 638   declare_constant(VM_Version::CPU_BMI1)                            \
 639   declare_constant(VM_Version::CPU_BMI2)                            \
 640   declare_constant(VM_Version::CPU_RTM)                             \
 641   declare_constant(VM_Version::CPU_ADX)                             \
 642   declare_constant(VM_Version::CPU_AVX512F)                         \
 643   declare_constant(VM_Version::CPU_AVX512DQ)                        \
 644   declare_constant(VM_Version::CPU_AVX512PF)                        \
 645   declare_constant(VM_Version::CPU_AVX512ER)                        \
 646   declare_constant(VM_Version::CPU_AVX512CD)
 647 
 648 #define VM_LONG_CONSTANTS_CPU(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant) \
 649   declare_preprocessor_constant("VM_Version::CPU_AVX512BW", CPU_AVX512BW) \
 650   declare_preprocessor_constant("VM_Version::CPU_AVX512VL", CPU_AVX512VL) \
 651   declare_preprocessor_constant("VM_Version::CPU_SHA", CPU_SHA)
 652 
 653 #endif // TARGET_ARCH_x86
 654 
 655 
 656 #ifdef TARGET_ARCH_sparc
 657 
 658 #define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field, unchecked_c1_static_field, unchecked_c2_static_field) \
 659   volatile_nonstatic_field(JavaFrameAnchor, _flags, int)
 660 
 661 #define VM_INT_CONSTANTS_CPU(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant) \
 662   declare_constant(VM_Version::vis1_instructions_m)                       \
 663   declare_constant(VM_Version::vis2_instructions_m)                       \
 664   declare_constant(VM_Version::vis3_instructions_m)                       \
 665   declare_constant(VM_Version::cbcond_instructions_m)                     \
 666   declare_constant(VM_Version::v8_instructions_m)                         \
 667   declare_constant(VM_Version::hardware_mul32_m)                          \
 668   declare_constant(VM_Version::hardware_div32_m)                          \
 669   declare_constant(VM_Version::hardware_fsmuld_m)                         \
 670   declare_constant(VM_Version::hardware_popc_m)                           \
 671   declare_constant(VM_Version::v9_instructions_m)                         \
 672   declare_constant(VM_Version::sun4v_m)                                   \
 673   declare_constant(VM_Version::blk_init_instructions_m)                   \
 674   declare_constant(VM_Version::fmaf_instructions_m)                       \
 675   declare_constant(VM_Version::fmau_instructions_m)                       \
 676   declare_constant(VM_Version::sparc64_family_m)                          \
 677   declare_constant(VM_Version::M_family_m)                                \
 678   declare_constant(VM_Version::T_family_m)                                \
 679   declare_constant(VM_Version::T1_model_m)                                \
 680   declare_constant(VM_Version::sparc5_instructions_m)                     \
 681   declare_constant(VM_Version::aes_instructions_m)                        \
 682   declare_constant(VM_Version::sha1_instruction_m)                        \
 683   declare_constant(VM_Version::sha256_instruction_m)                      \
 684   declare_constant(VM_Version::sha512_instruction_m)
 685 
 686 #endif // TARGET_ARCH_sparc
 687 
 688 
 689 /*
 690  * Dummy defines for architectures that don't use these.
 691  */
 692 #ifndef VM_STRUCTS_CPU
 693 #define VM_STRUCTS_CPU(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field, unchecked_c1_static_field, unchecked_c2_static_field)
 694 #endif
 695 
 696 #ifndef VM_TYPES_CPU
 697 #define VM_TYPES_CPU(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c1_toplevel_type, declare_c2_type, declare_c2_toplevel_type)
 698 #endif
 699 
 700 #ifndef VM_INT_CONSTANTS_CPU
 701 #define VM_INT_CONSTANTS_CPU(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant)
 702 #endif
 703 
 704 #ifndef VM_LONG_CONSTANTS_CPU
 705 #define VM_LONG_CONSTANTS_CPU(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant)
 706 #endif
 707 
 708 #ifndef VM_STRUCTS_OS
 709 #define VM_STRUCTS_OS(nonstatic_field, static_field, unchecked_nonstatic_field, volatile_nonstatic_field, nonproduct_nonstatic_field, c2_nonstatic_field, unchecked_c1_static_field, unchecked_c2_static_field)
 710 #endif
 711 
 712 #ifndef VM_TYPES_OS
 713 #define VM_TYPES_OS(declare_type, declare_toplevel_type, declare_oop_type, declare_integer_type, declare_unsigned_integer_type, declare_c1_toplevel_type, declare_c2_type, declare_c2_toplevel_type)
 714 #endif
 715 
 716 #ifndef VM_INT_CONSTANTS_OS
 717 #define VM_INT_CONSTANTS_OS(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant)
 718 #endif
 719 
 720 #ifndef VM_LONG_CONSTANTS_OS
 721 #define VM_LONG_CONSTANTS_OS(declare_constant, declare_preprocessor_constant, declare_c1_constant, declare_c2_constant, declare_c2_preprocessor_constant)
 722 #endif
 723 
 724 #ifndef VM_ADDRESSES_OS
 725 #define VM_ADDRESSES_OS(declare_address, declare_preprocessor_address, declare_function)
 726 #endif
 727 
 728 
 729 // whole purpose of this function is to work around bug c++/27724 in gcc 4.1.1
 730 // with optimization turned on it doesn't affect produced code
 731 static inline uint64_t cast_uint64_t(size_t x)
 732 {
 733   return x;
 734 }
 735 
 736 #define ASSIGN_CONST_TO_64BIT_VAR(var, expr) \
 737   JNIEXPORT uint64_t var = cast_uint64_t(expr);
 738 
 739 #define ASSIGN_OFFSET_TO_64BIT_VAR(var, type, field)   \
 740   ASSIGN_CONST_TO_64BIT_VAR(var, offset_of(type, field))
 741 
 742 #define ASSIGN_STRIDE_TO_64BIT_VAR(var, array) \
 743   ASSIGN_CONST_TO_64BIT_VAR(var, (char*)&amp;array[1] - (char*)&amp;array[0])
 744 
 745 //
 746 // Instantiation of VMStructEntries, VMTypeEntries and VMIntConstantEntries
 747 //
 748 
 749 // These initializers are allowed to access private fields in classes
 750 // as long as class VMStructs is a friend
 751 VMStructEntry JVMCIVMStructs::localHotSpotVMStructs[] = {
 752   VM_STRUCTS(GENERATE_NONSTATIC_VM_STRUCT_ENTRY,
 753              GENERATE_STATIC_VM_STRUCT_ENTRY,
 754              GENERATE_UNCHECKED_NONSTATIC_VM_STRUCT_ENTRY,
 755              GENERATE_NONSTATIC_VM_STRUCT_ENTRY)
 756 
 757   VM_STRUCTS_OS(GENERATE_NONSTATIC_VM_STRUCT_ENTRY,
 758                 GENERATE_STATIC_VM_STRUCT_ENTRY,
 759                 GENERATE_UNCHECKED_NONSTATIC_VM_STRUCT_ENTRY,
 760                 GENERATE_NONSTATIC_VM_STRUCT_ENTRY,
 761                 GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
 762                 GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY,
 763                 GENERATE_C1_UNCHECKED_STATIC_VM_STRUCT_ENTRY,
 764                 GENERATE_C2_UNCHECKED_STATIC_VM_STRUCT_ENTRY)
 765 
 766   VM_STRUCTS_CPU(GENERATE_NONSTATIC_VM_STRUCT_ENTRY,
 767                  GENERATE_STATIC_VM_STRUCT_ENTRY,
 768                  GENERATE_UNCHECKED_NONSTATIC_VM_STRUCT_ENTRY,
 769                  GENERATE_NONSTATIC_VM_STRUCT_ENTRY,
 770                  GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
 771                  GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY,
 772                  GENERATE_C1_UNCHECKED_STATIC_VM_STRUCT_ENTRY,
 773                  GENERATE_C2_UNCHECKED_STATIC_VM_STRUCT_ENTRY)
 774 
 775 #if INCLUDE_ALL_GCS
 776   VM_STRUCTS_G1(GENERATE_NONSTATIC_VM_STRUCT_ENTRY,
 777                 GENERATE_STATIC_VM_STRUCT_ENTRY)
 778 #endif
 779 
 780   GENERATE_VM_STRUCT_LAST_ENTRY()
 781 };
 782 
 783 VMTypeEntry JVMCIVMStructs::localHotSpotVMTypes[] = {
 784   VM_TYPES(GENERATE_VM_TYPE_ENTRY,
 785            GENERATE_TOPLEVEL_VM_TYPE_ENTRY,
 786            GENERATE_INTEGER_VM_TYPE_ENTRY,
 787            GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY)
 788 
 789   VM_TYPES_OS(GENERATE_VM_TYPE_ENTRY,
 790               GENERATE_TOPLEVEL_VM_TYPE_ENTRY,
 791               GENERATE_OOP_VM_TYPE_ENTRY,
 792               GENERATE_INTEGER_VM_TYPE_ENTRY,
 793               GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY,
 794               GENERATE_C1_TOPLEVEL_VM_TYPE_ENTRY,
 795               GENERATE_C2_VM_TYPE_ENTRY,
 796               GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY)
 797 
 798   VM_TYPES_CPU(GENERATE_VM_TYPE_ENTRY,
 799                GENERATE_TOPLEVEL_VM_TYPE_ENTRY,
 800                GENERATE_OOP_VM_TYPE_ENTRY,
 801                GENERATE_INTEGER_VM_TYPE_ENTRY,
 802                GENERATE_UNSIGNED_INTEGER_VM_TYPE_ENTRY,
 803                GENERATE_C1_TOPLEVEL_VM_TYPE_ENTRY,
 804                GENERATE_C2_VM_TYPE_ENTRY,
 805                GENERATE_C2_TOPLEVEL_VM_TYPE_ENTRY)
 806 
 807   GENERATE_VM_TYPE_LAST_ENTRY()
 808 };
 809 
 810 VMIntConstantEntry JVMCIVMStructs::localHotSpotVMIntConstants[] = {
 811   VM_INT_CONSTANTS(GENERATE_VM_INT_CONSTANT_ENTRY,
 812                    GENERATE_VM_INT_CONSTANT_WITH_VALUE_ENTRY,
 813                    GENERATE_PREPROCESSOR_VM_INT_CONSTANT_ENTRY)
 814 
 815   VM_INT_CONSTANTS_OS(GENERATE_VM_INT_CONSTANT_ENTRY,
 816                       GENERATE_PREPROCESSOR_VM_INT_CONSTANT_ENTRY,
 817                       GENERATE_C1_VM_INT_CONSTANT_ENTRY,
 818                       GENERATE_C2_VM_INT_CONSTANT_ENTRY,
 819                       GENERATE_C2_PREPROCESSOR_VM_INT_CONSTANT_ENTRY)
 820 
 821   VM_INT_CONSTANTS_CPU(GENERATE_VM_INT_CONSTANT_ENTRY,
 822                        GENERATE_PREPROCESSOR_VM_INT_CONSTANT_ENTRY,
 823                        GENERATE_C1_VM_INT_CONSTANT_ENTRY,
 824                        GENERATE_C2_VM_INT_CONSTANT_ENTRY,
 825                        GENERATE_C2_PREPROCESSOR_VM_INT_CONSTANT_ENTRY)
 826 
 827 #if INCLUDE_ALL_GCS
 828   VM_INT_CONSTANTS_G1(GENERATE_VM_INT_CONSTANT_ENTRY,
 829                       GENERATE_VM_INT_CONSTANT_WITH_VALUE_ENTRY,
 830                       GENERATE_PREPROCESSOR_VM_INT_CONSTANT_ENTRY)
 831 #endif
 832 
 833   GENERATE_VM_INT_CONSTANT_LAST_ENTRY()
 834 };
 835 
 836 VMLongConstantEntry JVMCIVMStructs::localHotSpotVMLongConstants[] = {
 837   VM_LONG_CONSTANTS(GENERATE_VM_LONG_CONSTANT_ENTRY,
 838                     GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
 839 
 840   VM_LONG_CONSTANTS_OS(GENERATE_VM_LONG_CONSTANT_ENTRY,
 841                        GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
 842                        GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
 843                        GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
 844                        GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
 845 
 846   VM_LONG_CONSTANTS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
 847                         GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
 848                         GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
 849                         GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
 850                         GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
 851 
 852   GENERATE_VM_LONG_CONSTANT_LAST_ENTRY()
 853 };
 854 
 855 VMAddressEntry JVMCIVMStructs::localHotSpotVMAddresses[] = {
 856   VM_ADDRESSES(GENERATE_VM_ADDRESS_ENTRY,
 857                GENERATE_PREPROCESSOR_VM_ADDRESS_ENTRY,
 858                GENERATE_VM_FUNCTION_ENTRY)
 859 
 860   VM_ADDRESSES_OS(GENERATE_VM_ADDRESS_ENTRY,
 861                   GENERATE_PREPROCESSOR_VM_ADDRESS_ENTRY,
 862                   GENERATE_VM_FUNCTION_ENTRY)
 863 
 864   GENERATE_VM_ADDRESS_LAST_ENTRY()
 865 };
 866 
 867 extern "C" {
 868 JNIEXPORT VMStructEntry* jvmciHotSpotVMStructs = JVMCIVMStructs::localHotSpotVMStructs;
 869 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMStructEntryTypeNameOffset,   VMStructEntry, typeName);
 870 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMStructEntryFieldNameOffset,  VMStructEntry, fieldName);
 871 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMStructEntryTypeStringOffset, VMStructEntry, typeString);
 872 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMStructEntryIsStaticOffset,   VMStructEntry, isStatic);
 873 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMStructEntryOffsetOffset,     VMStructEntry, offset);
 874 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMStructEntryAddressOffset,    VMStructEntry, address);
 875 ASSIGN_STRIDE_TO_64BIT_VAR(jvmciHotSpotVMStructEntryArrayStride, jvmciHotSpotVMStructs);
 876 
 877 JNIEXPORT VMTypeEntry* jvmciHotSpotVMTypes = JVMCIVMStructs::localHotSpotVMTypes;
 878 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMTypeEntryTypeNameOffset,       VMTypeEntry, typeName);
 879 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMTypeEntrySuperclassNameOffset, VMTypeEntry, superclassName);
 880 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMTypeEntryIsOopTypeOffset,      VMTypeEntry, isOopType);
 881 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMTypeEntryIsIntegerTypeOffset,  VMTypeEntry, isIntegerType);
 882 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMTypeEntryIsUnsignedOffset,     VMTypeEntry, isUnsigned);
 883 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMTypeEntrySizeOffset,           VMTypeEntry, size);
 884 ASSIGN_STRIDE_TO_64BIT_VAR(jvmciHotSpotVMTypeEntryArrayStride, jvmciHotSpotVMTypes);
 885 
 886 JNIEXPORT VMIntConstantEntry* jvmciHotSpotVMIntConstants = JVMCIVMStructs::localHotSpotVMIntConstants;
 887 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMIntConstantEntryNameOffset,  VMIntConstantEntry, name);
 888 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMIntConstantEntryValueOffset, VMIntConstantEntry, value);
 889 ASSIGN_STRIDE_TO_64BIT_VAR(jvmciHotSpotVMIntConstantEntryArrayStride, jvmciHotSpotVMIntConstants);
 890 
 891 JNIEXPORT VMLongConstantEntry* jvmciHotSpotVMLongConstants = JVMCIVMStructs::localHotSpotVMLongConstants;
 892 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMLongConstantEntryNameOffset,  VMLongConstantEntry, name);
 893 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMLongConstantEntryValueOffset, VMLongConstantEntry, value);
 894 ASSIGN_STRIDE_TO_64BIT_VAR(jvmciHotSpotVMLongConstantEntryArrayStride, jvmciHotSpotVMLongConstants);
 895 
 896 JNIEXPORT VMAddressEntry* jvmciHotSpotVMAddresses = JVMCIVMStructs::localHotSpotVMAddresses;
 897 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMAddressEntryNameOffset,  VMAddressEntry, name);
 898 ASSIGN_OFFSET_TO_64BIT_VAR(jvmciHotSpotVMAddressEntryValueOffset, VMAddressEntry, value);
 899 ASSIGN_STRIDE_TO_64BIT_VAR(jvmciHotSpotVMAddressEntryArrayStride, jvmciHotSpotVMAddresses);
 900 }
</pre></body></html>
